(window.webpackJsonp=window.webpackJsonp||[]).push([[32,7],{387:function(e,t,r){var content=r(396);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(35).default)("2c589959",content,!0,{sourceMap:!1})},395:function(e,t,r){"use strict";r(387)},396:function(e,t,r){var n=r(34)((function(i){return i[1]}));n.push([e.i,"canvas{background-color:#fff;border:1px solid #ccc;display:block;margin:auto}.line-color{stroke:#000}",""]),n.locals={},e.exports=n},398:function(e,t,r){"use strict";r.r(t);var n=r(0),o=(r(11),r(12),r(44),r(384)),c=r(402),l=r(404),d={props:{dxfUrl:{type:String,required:!0}},mounted:function(){this.loadDxfFile()},methods:{loadDxfFile:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r,n,d,f,h,v,y,x,m,w,F,O,I,_;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch(e.dxfUrl);case 3:return r=t.sent,t.next=6,r.text();case 6:n=t.sent,d=new l.a,f=d.parseSync(n),h=new o.Zc,v=new o.bc(75,e.$refs.canvas.clientWidth/e.$refs.canvas.clientHeight,.1,1e3),(y=new c.a({canvas:e.$refs.canvas,antialias:!0})).setClearColor(16777215,1),y.setSize(e.$refs.canvas.clientWidth,e.$refs.canvas.clientHeight),x=new o.ab,f.entities.forEach((function(e){if("LINE"===e.type){var t=new o.jb({color:0}),r=(new o.n).setFromPoints([new o.vd(e.vertices[0].x,e.vertices[0].y,0),new o.vd(e.vertices[1].x,e.vertices[1].y,0)]),line=new o.ib(r,t);x.add(line)}})),h.add(x),m=(new o.k).setFromObject(x),w=m.getCenter(new o.vd),F=m.getSize(new o.vd),x.position.set(-w.x,-w.y,0),O=Math.max(F.x,F.y),I=v.fov*(Math.PI/180),_=Math.abs(O/(2*Math.tan(I/2))),v.position.set(0,0,_+10),v.lookAt(new o.vd(0,0,0)),y.render(h,v),t.next=32;break;case 29:t.prev=29,t.t0=t.catch(0),console.error("Failed to load DXF file:",t.t0);case 32:case"end":return t.stop()}}),t,null,[[0,29]])})))()}}},f=(r(395),r(15)),component=Object(f.a)(d,(function(){var e=this._self._c;return e("div",[e("canvas",{ref:"canvas",staticClass:"line-color w-full flex items-center justify-center hover:scale-150"})])}),[],!1,null,null,null);t.default=component.exports},399:function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var n=r(121);var o=r(162),c=r(99);function l(e){return function(e){if(Array.isArray(e))return Object(n.a)(e)}(e)||Object(o.a)(e)||Object(c.a)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},425:function(e,t,r){var content=r(455);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(35).default)("ae73f282",content,!0,{sourceMap:!1})},454:function(e,t,r){"use strict";r(425)},455:function(e,t,r){var n=r(34)((function(i){return i[1]}));n.push([e.i,".container[data-v-46eb9d5d]{padding:1rem}.show_file_section[data-v-46eb9d5d],.show_files_name[data-v-46eb9d5d]{border:1px solid #ccc;padding:1rem}.cursor-pointer[data-v-46eb9d5d]{cursor:pointer}ol[data-v-46eb9d5d]{list-style-type:decimal}",""]),n.locals={},e.exports=n},485:function(e,t,r){"use strict";r.r(t);r(23),r(56),r(33),r(53),r(77),r(78),r(24),r(31);var n=r(29),o=r(399),c=r(0),l=r(36),d=(r(11),r(39),r(50),r(45),r(54),r(80),r(52),r(243),r(51),r(12),r(97),r(26),r(44),r(30),r(247),r(248),r(160),r(79));function f(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,a){if(e){if("string"==typeof e)return h(e,a);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?h(e,a):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,a=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){u=!0,c=e},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw c}}}}function h(e,a){(null==a||a>e.length)&&(a=e.length);for(var t=0,r=Array(a);t<a;t++)r[t]=e[t];return r}function v(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?v(Object(r),!0).forEach((function(t){Object(l.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var x={components:{DxfViewer:r(398).default},layout:"EngineerLayout",middleware:["admin","roleRedirect"],data:function(){return{factories:{ids:[],files:{}},isDoneDetails:!0,selectedClient:null,order:{name:null,quantity:null,description:null},formSubmitted:!1,isSelectedLaser:!1,isSelectedBend:!1,fileNames:[],dxfUrl:"",files:[],selectedFactoryId:null,selectedFileIndex:null,orderId:null}},computed:y(y(y(y({},Object(d.c)("factory",["getFactory"])),Object(d.c)("users",["getUsers"])),Object(d.c)("engineer",["getOrder"])),{},{users:function(){return this.getUsers}}),mounted:function(){var e=this;this.fetchUsers(),this.fetchFactory(),this.formSubmitted=!0,this.isDoneDetails=!1,this.selectedFactoryId=1,this.factories.ids.includes(1)||this.factories.ids.push(1),this.factories.files[1]||(this.factories.files[1]=[]),this.selectedFileIndex=null,this.dxfUrl="",this.fileNames=[],this.orderId=this.$route.params.id,this.fetchOrderDataById(this.orderId).then((function(){e.initializeFiles()}))},methods:y(y(y(y({},Object(d.b)("factory",["fetchFactory"])),Object(d.b)("users",["fetchUsers"])),Object(d.b)("engineer",["createNewOrder","fetchOrderDataById","saveOrderFilesByFactory"])),{},{initializeFiles:function(){var e=this;return Object(c.a)(regeneratorRuntime.mark((function t(){var r,n,o,c,l,d,h,v,y,x,m;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(r=e.getOrder)||!r.factory_orders){t.next=48;break}n=f(r.factory_orders),t.prev=3,n.s();case 5:if((o=n.n()).done){t.next=40;break}c=o.value,l=c.factory_id,e.factories.files[l]||(e.factories.files[l]=[]),d=f(c.files),t.prev=10,d.s();case 12:if((h=d.n()).done){t.next=30;break}return v=h.value,t.prev=14,t.next=17,fetch("/".concat(v.path));case 17:return y=t.sent,t.next=20,y.blob();case 20:x=t.sent,m=new File([x],v.original_name,{type:"application/dxf"}),e.factories.files[l].push(m),t.next=28;break;case 25:t.prev=25,t.t0=t.catch(14),console.error("Error loading file:",t.t0);case 28:t.next=12;break;case 30:t.next=35;break;case 32:t.prev=32,t.t1=t.catch(10),d.e(t.t1);case 35:return t.prev=35,d.f(),t.finish(35);case 38:t.next=5;break;case 40:t.next=45;break;case 42:t.prev=42,t.t2=t.catch(3),n.e(t.t2);case 45:return t.prev=45,n.f(),t.finish(45);case 48:case"end":return t.stop()}}),t,null,[[3,42,45,48],[10,32,35,38],[14,25]])})))()},deleteFile:function(e){this.selectedFactoryId&&this.factories.files[this.selectedFactoryId]&&(this.factories.files[this.selectedFactoryId].splice(e,1),0===this.factories.files[this.selectedFactoryId].length?(this.dxfUrl="",this.selectedFileIndex=null):(this.selectedFileIndex=0,this.loadFile(this.factories.files[this.selectedFactoryId][0])))},selectFactory:function(e){this.selectedFactoryId=e.id,this.factories.ids.includes(e.id)||this.factories.ids.push(e.id),this.factories.files[e.id]||(this.factories.files[e.id]=[]),this.selectedFileIndex=null,this.dxfUrl="",this.fileNames=[]},handleFileChange:function(e){var t=Array.from(e.target.files);this.selectedFactoryId?(this.factories.files[this.selectedFactoryId]||(this.factories.files[this.selectedFactoryId]=[]),this.factories.files[this.selectedFactoryId]=[].concat(Object(o.a)(this.factories.files[this.selectedFactoryId]),t),this.fileNames=this.factories.files[this.selectedFactoryId].map((function(e){return e.name})),this.loadFile(t[0])):console.error("Գործարան ընտրված չէ")},selectFile:function(e){if(this.selectedFactoryId){var t=this.factories.files[this.selectedFactoryId][e];t?(this.selectedFileIndex=e,this.loadFile(t)):console.error("File not found")}else console.error("No factory selected")},loadFile:function(e){var t=this;if(e instanceof Blob){var r=new FileReader;r.onload=function(e){var r=new Blob([e.target.result],{type:"application/dxf"});t.dxfUrl=URL.createObjectURL(r)},r.onerror=function(e){console.error("Error reading file:",e)},r.readAsArrayBuffer(e)}else console.error("Invalid file type")},saveFiles:function(){var e=this;if(this.orderId){var t=new FormData;t.append("order_id",this.orderId),Object.keys(this.factories.files).forEach((function(r){var n=e.factories.files[r]||[];n.length>0&&(t.append("factories[".concat(r,"][id]"),r),n.forEach((function(e,n){t.append("factories[".concat(r,"][files][").concat(n,"]"),e)})))}));var r,o=f(t.entries());try{for(o.s();!(r=o.n()).done;){var c=Object(n.a)(r.value,2),l=c[0],d=c[1];console.log(l,d)}}catch(e){o.e(e)}finally{o.f()}this.saveOrderFilesByFactory(t).then((function(){alert("Ֆայլերը հաջողությամբ պահպանված են։")})).catch((function(e){console.error("Ֆայլերը պահպանելիս սխալ:",e),alert("Ֆայլերը պահպանելիս սխալ։")}))}else console.error("Պատվերի ID չի գտնվել։")},doneToFiles:function(){},createOrder:function(){var e={user_id:this.selectedClient.id,name:this.order.name,quantity:this.order.quantity,description:this.order.description};this.createNewOrder(e)}})},m=(r(454),r(15)),component=Object(m.a)(x,(function(){var e,t=this,r=t._self._c;return r("div",{staticClass:"flex flex-col items-center justify-center gap-12 border border-neutral-400 shadow-xl rounded-xl py-4 m-6"},[r("div",{staticClass:"w-full flex flex-row items-center gap-12"},[r("div",{staticClass:"flex flex-row items-center mx-auto gap-12"},t._l(t.getFactory,(function(e,n){return r("div",{key:n},[r("button",{class:{"border border-neutral-600 rounded-lg px-3 py-1 italic font-sans":!0,"bg-gray-900 text-white":t.selectedFactoryId===e.id,"bg-gray-600 text-white":t.factories.files[e.id]&&t.factories.files[e.id].length>0},on:{click:function(r){return t.selectFactory(e)}}},[t._v("\n          "+t._s(e.name)+"\n        ")])])})),0),t._v(" "),r("nuxt-link",{staticClass:"ml-auto mr-6",attrs:{to:"/engineer"}},[r("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",x:"0px",y:"0px",width:"25",height:"25",fill:"red",viewBox:"0 0 30 30"}},[r("path",{attrs:{d:"M15,3C8.373,3,3,8.373,3,15c0,6.627,5.373,12,12,12s12-5.373,12-12C27,8.373,21.627,3,15,3z M16.414,15 c0,0,3.139,3.139,3.293,3.293c0.391,0.391,0.391,1.024,0,1.414c-0.391,0.391-1.024,0.391-1.414,0C18.139,19.554,15,16.414,15,16.414 s-3.139,3.139-3.293,3.293c-0.391,0.391-1.024,0.391-1.414,0c-0.391-0.391-0.391-1.024,0-1.414C10.446,18.139,13.586,15,13.586,15 s-3.139-3.139-3.293-3.293c-0.391-0.391-0.391-1.024,0-1.414c0.391-0.391,1.024-0.391,1.414,0C11.861,10.446,15,13.586,15,13.586 s3.139-3.139,3.293-3.293c0.391-0.391,1.024-0.391,1.414,0c0.391,0.391,0.391,1.024,0,1.414C19.554,11.861,16.414,15,16.414,15z"}})])])],1),t._v(" "),t.selectedFactoryId?r("div",{staticClass:"container flex flex-col"},[r("div",{staticClass:"grid grid-cols-2 gap-8"},[r("div",{staticClass:"show_file_section"},[t.dxfUrl?r("DxfViewer",{key:t.dxfUrl,attrs:{"dxf-url":t.dxfUrl}}):t._e()],1),t._v(" "),r("div",{staticClass:"show_files_name min-h-96 max-h-[32rem] overflow-y-auto"},[r("div",{staticClass:"w-full my-4"},[r("input",{attrs:{type:"file",multiple:""},on:{change:t.handleFileChange}})]),t._v(" "),(null===(e=t.factories.files[t.selectedFactoryId])||void 0===e?void 0:e.length)>0?r("div",[r("ol",{staticClass:"list-decimal px-3"},t._l(t.factories.files[t.selectedFactoryId],(function(e,n){return r("li",{key:n},[r("div",{staticClass:"cursor-pointer grid grid-cols-2 justify-between",class:{"border border-neutral-600 rounded-lg px-3 py-1 italic font-sans":!0,"bg-gray-900 text-white":t.selectedFileIndex===n},on:{click:function(e){return t.selectFile(n)}}},[r("span",[t._v(t._s(e.name))]),t._v(" "),r("div",{staticClass:"ml-auto",on:{click:function(e){return t.deleteFile(n)}}},[r("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",x:"0px",y:"0px",width:"20",height:"20",fill:"red",viewBox:"0 0 24 24"}},[r("path",{attrs:{d:"M 10.806641 2 C 10.289641 2 9.7956875 2.2043125 9.4296875 2.5703125 L 9 3 L 4 3 A 1.0001 1.0001 0 1 0 4 5 L 20 5 A 1.0001 1.0001 0 1 0 20 3 L 15 3 L 14.570312 2.5703125 C 14.205312 2.2043125 13.710359 2 13.193359 2 L 10.806641 2 z M 4.3652344 7 L 5.8925781 20.263672 C 6.0245781 21.253672 6.877 22 7.875 22 L 16.123047 22 C 17.121047 22 17.974422 21.254859 18.107422 20.255859 L 19.634766 7 L 4.3652344 7 z"}})])])])])})),0)]):r("div",[r("p",[t._v("Ֆայլ չկա ընտրված գործարանի համար:")])])])]),t._v(" "),r("div",{staticClass:"flex flex-row items-center justify-end gap-12 text-right my-3"},[r("button",{staticClass:"border border-green-700 bg-green-700 text-white rounded-xl px-3 py-1",on:{click:t.saveFiles}},[t._v("\n        Պահպանել Ֆայլերը\n      ")]),t._v(" "),r("button",{staticClass:"border border-green-700 bg-green-700 text-white rounded-xl px-3 py-1"},[t._v("\n        Շարունակել\n      ")])])]):t._e()])}),[],!1,null,"46eb9d5d",null);t.default=component.exports}}]);