(window.webpackJsonp=window.webpackJsonp||[]).push([[84,45],{463:function(e,t,r){"use strict";var o=r(3),n=r(282).trim;o({target:"String",proto:!0,forced:r(464)("trim")},{trim:function(){return n(this)}})},464:function(e,t,r){"use strict";var o=r(112).PROPER,n=r(5),l=r(283);e.exports=function(e){return n(function(){return!!l[e]()||"​᠎"!=="​᠎"[e]()||o&&l[e].name!==e})}},569:function(e,t,r){"use strict";r.r(t);r(20),r(43),r(18),r(6),r(463);var o={name:"WorkerFormModal",props:{visible:{type:Boolean,default:!1},worker:{type:Object,default:null},roles:{type:Array,default:function(){return[]}},submitting:{type:Boolean,default:!1}},data:function(){return{form:{name:"",last_name:"",email:"",role_id:"",phone:"",second_phone:"",address:"",password:"",password_confirmation:""}}},computed:{isEdit:function(){return!(!this.worker||!this.worker.id)}},watch:{visible:function(e){e?this.bootstrap():this.reset()}},methods:{bootstrap:function(){if(this.isEdit){var e,t,r,o,u=this.worker;this.form={name:(null==u?void 0:u.name)||"",last_name:(null==u||null===(e=u.client)||void 0===e?void 0:e.last_name)||"",email:(null==u?void 0:u.email)||"",role_id:(null==u?void 0:u.role_id)||"",phone:(null==u||null===(t=u.client)||void 0===t?void 0:t.phone)||"",second_phone:(null==u||null===(r=u.client)||void 0===r?void 0:r.second_phone)||"",address:(null==u||null===(o=u.client)||void 0===o?void 0:o.address)||"",password:"",password_confirmation:""}}else this.reset()},reset:function(){this.form={name:"",last_name:"",email:"",role_id:"",phone:"",second_phone:"",address:"",password:"",password_confirmation:""}},validate:function(){if(!this.form.name.trim())return"Անունը պարտադիր է";if(!this.form.email.trim())return"Էլ․ փոստը պարտադիր է";if(!this.form.role_id)return"Ընտրեք դեր";if(!this.form.phone.trim())return"Հեռախոսը պարտադիր է";if(!this.isEdit){if(!this.form.password)return"Գաղտնաբառը պարտադիր է";if(this.form.password.length<6)return"Գաղտնաբառը պետք է լինի ≥ 6 սիմվոլ";if(this.form.password!==this.form.password_confirmation)return"Գաղտնաբառերը չեն համընկնում"}return null},submit:function(){var e,t=this.validate();if(t)return alert(t);var r={name:this.form.name,last_name:this.form.last_name||null,email:this.form.email,role_id:this.form.role_id,type:"worker",phone:this.form.phone,second_phone:this.form.second_phone||null,address:this.form.address||null};this.isEdit||(r.password=this.form.password,r.password_confirmation=this.form.password_confirmation),this.$emit("submit",{payload:r,isEdit:this.isEdit,id:null===(e=this.worker)||void 0===e?void 0:e.id})}}},n=r(11),component=Object(n.a)(o,function(){var e=this,t=e._self._c;return e.visible?t("div",{staticClass:"fixed inset-0 z-[1100] bg-black/50 flex items-center justify-center p-4",on:{click:function(t){return t.target!==t.currentTarget?null:e.$emit("close")}}},[t("div",{staticClass:"w-full max-w-2xl bg-white rounded-2xl shadow-xl flex flex-col max-h-[90vh] overflow-hidden"},[t("div",{staticClass:"flex items-center justify-between px-5 py-4 border-b"},[t("h3",{staticClass:"text-lg font-semibold"},[e._v("\n        "+e._s(e.isEdit?"Խմբագրել աշխատակցին":"Ստեղծել նոր աշխատակից")+"\n      ")]),e._v(" "),t("button",{staticClass:"rounded-lg p-1 hover:bg-gray-100",on:{click:function(t){return e.$emit("close")}}},[e._v("\n        ✕\n      ")])]),e._v(" "),t("div",{staticClass:"px-5 py-4 overflow-y-auto"},[t("form",{staticClass:"space-y-4",on:{submit:function(t){return t.preventDefault(),e.submit.apply(null,arguments)}}},[t("div",{staticClass:"grid grid-cols-1 sm:grid-cols-2 gap-4"},[t("div",[t("label",{staticClass:"block text-sm mb-1"},[e._v("Անուն")]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.form.name,expression:"form.name",modifiers:{trim:!0}}],staticClass:"w-full rounded-lg border px-3 py-2",attrs:{type:"text"},domProps:{value:e.form.name},on:{input:function(t){t.target.composing||e.$set(e.form,"name",t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}})]),e._v(" "),t("div",[t("label",{staticClass:"block text-sm mb-1"},[e._v("Ազգանուն")]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.form.last_name,expression:"form.last_name",modifiers:{trim:!0}}],staticClass:"w-full rounded-lg border px-3 py-2",attrs:{type:"text"},domProps:{value:e.form.last_name},on:{input:function(t){t.target.composing||e.$set(e.form,"last_name",t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}})]),e._v(" "),t("div",[t("label",{staticClass:"block text-sm mb-1"},[e._v("Էլ․ փոստ")]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.form.email,expression:"form.email",modifiers:{trim:!0}}],staticClass:"w-full rounded-lg border px-3 py-2",attrs:{type:"email"},domProps:{value:e.form.email},on:{input:function(t){t.target.composing||e.$set(e.form,"email",t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}})]),e._v(" "),t("div",[t("label",{staticClass:"block text-sm mb-1"},[e._v("Դեր")]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.form.role_id,expression:"form.role_id"}],staticClass:"w-full rounded-lg border px-3 py-2",on:{change:function(t){var r=Array.prototype.filter.call(t.target.options,function(e){return e.selected}).map(function(e){return"_value"in e?e._value:e.value});e.$set(e.form,"role_id",t.target.multiple?r:r[0])}}},[t("option",{attrs:{disabled:"",value:""}},[e._v("Ընտրել դեր")]),e._v(" "),e._l(e.roles,function(r){return t("option",{key:r.id,domProps:{value:r.id}},[e._v("\n                "+e._s(r.name)+"\n              ")])})],2)]),e._v(" "),t("div",[t("label",{staticClass:"block text-sm mb-1"},[e._v("Հեռախոս")]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.form.phone,expression:"form.phone",modifiers:{trim:!0}}],staticClass:"w-full rounded-lg border px-3 py-2",attrs:{type:"text"},domProps:{value:e.form.phone},on:{input:function(t){t.target.composing||e.$set(e.form,"phone",t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}})]),e._v(" "),t("div",[t("label",{staticClass:"block text-sm mb-1"},[e._v("Երկրորդ հեռախոս")]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.form.second_phone,expression:"form.second_phone",modifiers:{trim:!0}}],staticClass:"w-full rounded-lg border px-3 py-2",attrs:{type:"text"},domProps:{value:e.form.second_phone},on:{input:function(t){t.target.composing||e.$set(e.form,"second_phone",t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}})]),e._v(" "),t("div",{staticClass:"sm:col-span-2"},[t("label",{staticClass:"block text-sm mb-1"},[e._v("Հասցե")]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.form.address,expression:"form.address",modifiers:{trim:!0}}],staticClass:"w-full rounded-lg border px-3 py-2",attrs:{type:"text"},domProps:{value:e.form.address},on:{input:function(t){t.target.composing||e.$set(e.form,"address",t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}})])]),e._v(" "),e.isEdit?e._e():t("div",{staticClass:"grid grid-cols-1 sm:grid-cols-2 gap-4"},[t("div",[t("label",{staticClass:"block text-sm mb-1"},[e._v("Գաղտնաբառ")]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.form.password,expression:"form.password"}],staticClass:"w-full rounded-lg border px-3 py-2",attrs:{type:"password"},domProps:{value:e.form.password},on:{input:function(t){t.target.composing||e.$set(e.form,"password",t.target.value)}}})]),e._v(" "),t("div",[t("label",{staticClass:"block text-sm mb-1"},[e._v("Գաղտնաբառի կրկնություն")]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.form.password_confirmation,expression:"form.password_confirmation"}],staticClass:"w-full rounded-lg border px-3 py-2",attrs:{type:"password"},domProps:{value:e.form.password_confirmation},on:{input:function(t){t.target.composing||e.$set(e.form,"password_confirmation",t.target.value)}}})])])])]),e._v(" "),t("div",{staticClass:"px-5 py-4 border-t flex justify-end gap-3"},[t("button",{staticClass:"px-4 py-2 rounded-lg border",on:{click:function(t){return e.$emit("close")}}},[e._v("\n        Փակել\n      ")]),e._v(" "),t("button",{staticClass:"px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 disabled:bg-blue-400",attrs:{disabled:e.submitting},on:{click:e.submit}},[e._v("\n        "+e._s(e.submitting?"Պահպանում…":e.isEdit?"Պահպանել":"Ստեղծել")+"\n      ")])])])]):e._e()},[],!1,null,null,null);t.default=component.exports},656:function(e,t,r){"use strict";r.r(t);r(18),r(19),r(29),r(30),r(25),r(26);var o=r(0),n=r(10),l=(r(9),r(20),r(53),r(6),r(60),r(463),r(31));function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,o)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach(function(t){Object(n.a)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var m={components:{WorkerFormModal:r(569).default},layout:"ManagerLayout",middleware:["manager","roleRedirect"],data:function(){return{loading:!1,workers:[],searchQuery:"",isFormOpen:!1,selectedWorker:null,submitting:!1,confirmDelete:null}},computed:c(c({},Object(l.c)("roles",["roles"])),{},{filtered:function(){var q=(this.searchQuery||"").toLowerCase().trim();return q?this.workers.filter(function(u){var e;return(u.name||"").toLowerCase().includes(q)||(u.email||"").toLowerCase().includes(q)||((null==u||null===(e=u.client)||void 0===e?void 0:e.phone)||"").toLowerCase().includes(q)}):this.workers},canDelete:function(){return!1}}),mounted:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=1,e.fetchRoles();case 1:return t.next=2,e.loadWorkers();case 2:case"end":return t.stop()}},t)}))()},methods:c(c({},Object(l.b)("roles",["fetchRoles"])),{},{loadWorkers:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark(function t(){var r,data,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.loading=!0,t.prev=1,t.next=2,e.$axios.get("/api/workers");case 2:r=t.sent,data=r.data,e.workers=Array.isArray(null==data?void 0:data.data)?data.data:Array.isArray(data)?data:[],t.next=4;break;case 3:t.prev=3,o=t.catch(1),console.error("Failed to fetch workers",o);case 4:return t.prev=4,e.loading=!1,t.finish(4);case 5:case"end":return t.stop()}},t,null,[[1,3,4,5]])}))()},openCreate:function(){this.selectedWorker=null,this.isFormOpen=!0,document.documentElement.classList.add("overflow-hidden")},openEdit:function(u){this.selectedWorker=u,this.isFormOpen=!0,document.documentElement.classList.add("overflow-hidden")},closeForm:function(){this.isFormOpen=!1,this.selectedWorker=null,document.documentElement.classList.remove("overflow-hidden")},handleSubmit:function(e){var t=this;return Object(o.a)(regeneratorRuntime.mark(function r(){var o,n,l,d,c,m,f,v,h;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(o=e.payload,n=e.isEdit,l=e.id,t.submitting=!0,r.prev=1,!n){r.next=4;break}return r.next=2,t.$axios.put("/api/workers/".concat(l),o);case 2:if(d=r.sent,(c=d.data)&&!1!==c.status){r.next=3;break}throw new Error((null==c?void 0:c.message)||"Update failed");case 3:r.next=6;break;case 4:return r.next=5,t.$axios.post("/api/workers",o);case 5:if(m=r.sent,(f=m.data)&&!1!==f.status){r.next=6;break}throw new Error((null==f?void 0:f.message)||"Create failed");case 6:return t.closeForm(),r.next=7,t.loadWorkers();case 7:r.next=9;break;case 8:r.prev=8,h=r.catch(1),console.error("Submit worker error:",h),alert((null===(v=h.response)||void 0===v||null===(v=v.data)||void 0===v?void 0:v.message)||h.message||"Սխալ՝ պահպանման ժամանակ");case 9:return r.prev=9,t.submitting=!1,r.finish(9);case 10:case"end":return r.stop()}},r,null,[[1,8,9,10]])}))()},askDelete:function(u){this.confirmDelete=u},doDelete:function(){this.confirmDelete=null}})},f=r(11),component=Object(f.a)(m,function(){var e,t=this,r=t._self._c;return r("div",{staticClass:"container mx-auto px-4 sm:px-6 lg:px-8 py-8"},[r("div",{staticClass:"flex flex-col sm:flex-row items-center justify-between gap-3 mb-6"},[r("h1",{staticClass:"text-xl sm:text-2xl font-semibold"},[t._v("Աշխատակիցներ")]),t._v(" "),r("div",{staticClass:"flex items-center gap-3 w-full sm:w-auto"},[r("input",{directives:[{name:"model",rawName:"v-model",value:t.searchQuery,expression:"searchQuery"}],staticClass:"w-full sm:w-64 rounded-lg border px-3 py-2",attrs:{type:"text",placeholder:"Որոնել անուն / email / հեռ."},domProps:{value:t.searchQuery},on:{input:function(e){e.target.composing||(t.searchQuery=e.target.value)}}}),t._v(" "),r("button",{staticClass:"inline-flex items-center gap-2 rounded-lg bg-blue-600 text-white px-4 py-2 hover:bg-blue-700",on:{click:t.openCreate}},[r("svg",{staticClass:"w-5 h-5",attrs:{viewBox:"0 0 24 24",fill:"none"}},[r("path",{attrs:{d:"M12 5v14m-7-7h14",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"}})]),t._v("\n        Նոր աշխատակից\n      ")])])]),t._v(" "),r("div",{staticClass:"bg-white dark:bg-gray-800 shadow-xl rounded-xl overflow-hidden"},[r("div",{staticClass:"overflow-x-auto"},[r("table",{staticClass:"w-full text-sm text-left text-gray-700"},[t._m(0),t._v(" "),r("tbody",[t._l(t.filtered,function(u){var e,o;return r("tr",{key:u.id,staticClass:"bg-white border-b hover:bg-gray-50"},[r("td",{staticClass:"px-6 py-3"},[t._v(t._s(u.name))]),t._v(" "),r("td",{staticClass:"px-6 py-3"},[t._v(t._s(u.email||"—"))]),t._v(" "),r("td",{staticClass:"px-6 py-3"},[t._v(t._s((null==u||null===(e=u.client)||void 0===e?void 0:e.phone)||"—"))]),t._v(" "),r("td",{staticClass:"px-6 py-3"},[t._v(t._s((null==u||null===(o=u.client)||void 0===o?void 0:o.address)||"—"))]),t._v(" "),r("td",{staticClass:"px-6 py-3"},[r("div",{staticClass:"flex justify-end gap-2"},[r("button",{staticClass:"px-3 py-1.5 rounded-lg border",on:{click:function(e){return t.openEdit(u)}}},[t._v("\n                  Խմբագրել\n                ")]),t._v(" "),r("button",{staticClass:"px-3 py-1.5 rounded-lg border text-red-600 hover:bg-red-50",attrs:{disabled:!t.canDelete,title:"Ջնջել"},on:{click:function(e){return t.askDelete(u)}}},[t._v("\n                  Ջնջել\n                ")])])])])}),t._v(" "),t.loading||0!==t.filtered.length?t._e():r("tr",[r("td",{staticClass:"px-6 py-6 text-center text-gray-500",attrs:{colspan:"5"}},[t._v("\n              Աշխատակից չի գտնվել\n            ")])])],2)])])]),t._v(" "),r("WorkerFormModal",{attrs:{visible:t.isFormOpen,worker:t.selectedWorker,roles:t.roles,submitting:t.submitting},on:{close:t.closeForm,submit:t.handleSubmit}}),t._v(" "),t.confirmDelete?r("div",{staticClass:"fixed inset-0 z-[1000] bg-black/50 flex items-center justify-center p-4",on:{click:function(e){if(e.target!==e.currentTarget)return null;t.confirmDelete=null}}},[r("div",{staticClass:"w-full max-w-md rounded-xl bg-white shadow-xl p-6"},[r("h3",{staticClass:"text-lg font-semibold mb-2"},[t._v("Ջնջե՞լ աշխատակցին")]),t._v(" "),r("p",{staticClass:"text-gray-600 mb-6"},[t._v("\n        Դուք պատրաստվում եք ջնջել «"+t._s(null===(e=t.confirmDelete)||void 0===e?void 0:e.name)+"» աշխատակցին։\n      ")]),t._v(" "),r("div",{staticClass:"flex justify-end gap-3"},[r("button",{staticClass:"px-4 py-2 rounded-lg border",on:{click:function(e){t.confirmDelete=null}}},[t._v("\n          Չեղարկել\n        ")]),t._v(" "),r("button",{staticClass:"px-4 py-2 rounded-lg bg-red-600 text-white hover:bg-red-700",attrs:{disabled:t.submitting||!t.canDelete},on:{click:t.doDelete}},[t._v("\n          "+t._s(t.submitting?"Կատարվում է…":"Ջնջել")+"\n        ")])])])]):t._e()],1)},[function(){var e=this,t=e._self._c;return t("thead",{staticClass:"text-xs uppercase bg-gray-100"},[t("tr",[t("th",{staticClass:"px-6 py-3"},[e._v("Անուն")]),e._v(" "),t("th",{staticClass:"px-6 py-3"},[e._v("Էլ․ փոստ")]),e._v(" "),t("th",{staticClass:"px-6 py-3"},[e._v("Հեռախոս")]),e._v(" "),t("th",{staticClass:"px-6 py-3"},[e._v("Հասցե")]),e._v(" "),t("th",{staticClass:"px-6 py-3 w-32 text-right"},[e._v("Գործողություններ")])])])}],!1,null,null,null);t.default=component.exports}}]);