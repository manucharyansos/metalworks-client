(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{701:function(e,r,t){var content=t(757);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,t(57).default)("8bddc48e",content,!0,{sourceMap:!1})},756:function(e,r,t){"use strict";t(701)},757:function(e,r,t){var n=t(56)(function(i){return i[1]});n.push([e.i,"",""]),n.locals={},e.exports=n},801:function(e,r,t){"use strict";t.r(r);var n=t(1),o=(t(9),t(49),t(27),t(8),t(30),t(570)),c=t(589),l=t(597),d={name:"DxfCanvas",props:{dxfUrl:{type:String,required:!0}},data:function(){return{scene:null,camera:null,renderer:null,dxfGroup:null,error:null,raf:null,onResizeHandler:null}},watch:{dxfUrl:function(){this.loadDxfFile()}},mounted:function(){var e=this;this.initThreeJS(),this.loadDxfFile(),this.onResizeHandler=function(){return e.resizeRenderer()},window.addEventListener("resize",this.onResizeHandler)},beforeDestroy:function(){window.removeEventListener("resize",this.onResizeHandler),cancelAnimationFrame(this.raf),this.cleanupThreeJS()},methods:{initThreeJS:function(){var canvas=this.$refs.canvas;this.scene=new o.ld,this.camera=new o.lc(75,1,.1,1e3);var e=window.devicePixelRatio||1;this.renderer=new c.a({canvas:canvas,antialias:!0}),this.renderer.setPixelRatio(e),this.resizeRenderer(),this.renderer.setClearColor(16777215,1)},resizeRenderer:function(){var canvas=this.$refs.canvas;if(canvas){var rect=canvas.getBoundingClientRect(),e=Math.max(200,rect.width),r=Math.max(200,rect.height);this.renderer.setSize(e,r,!1),this.camera.aspect=e/r,this.camera.updateProjectionMatrix(),this.renderOnce()}},cleanupThreeJS:function(){this.renderer&&this.renderer.dispose(),this.scene&&(this.scene.traverse(function(e){var r,t,n,o;(e.isMesh||e.isLine)&&(null===(r=e.geometry)||void 0===r||null===(t=r.dispose)||void 0===t||t.call(r),Array.isArray(e.material)?e.material.forEach(function(e){return e.dispose()}):null===(n=e.material)||void 0===n||null===(o=n.dispose)||void 0===o||o.call(n))}),this.scene.clear()),this.dxfGroup&&(this.dxfGroup.traverse(function(e){var r,t,n,o;null===(r=e.geometry)||void 0===r||null===(t=r.dispose)||void 0===t||t.call(r),Array.isArray(e.material)?e.material.forEach(function(e){return e.dispose()}):null===(n=e.material)||void 0===n||null===(o=n.dispose)||void 0===o||o.call(n)}),this.dxfGroup.clear())},loadDxfFile:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark(function r(){var t,n,o,c,l,d,h;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,t="/api/factories/getFile/".concat(e.dxfUrl),r.next=1,e.$axios.get(t);case 1:if(200===(n=r.sent).status){r.next=2;break}throw new Error("HTTP սխալ ".concat(n.status));case 2:if((o=n.data)&&o.content){r.next=3;break}throw new Error("Ֆայլի տվյալները բացակայում են։");case 3:try{l=atob(o.content),d=JSON.parse(l),c=d.content?atob(d.content):l}catch(e){c=atob(o.content)}e.parseDxf(c),e.error=null,r.next=5;break;case 4:r.prev=4,h=r.catch(0),console.error("DXF load error:",h),e.error=h.message;case 5:case"end":return r.stop()}},r,null,[[0,4]])}))()},parseDxf:function(e){var r=this;try{var t=(new l.a).parseSync(e);if(!t||!t.entities)throw new Error("Տվյալներ չեն գտնվել DXF-ում");this.dxfGroup&&this.scene.remove(this.dxfGroup),this.dxfGroup=new o.hb,t.entities.forEach(function(e){var t,n;if("LINE"===e.type&&(null===(t=e.vertices)||void 0===t?void 0:t.length)>=2){var c=new o.qb({color:0}),l=(new o.p).setFromPoints([new o.Jd(e.vertices[0].x,e.vertices[0].y,0),new o.Jd(e.vertices[1].x,e.vertices[1].y,0)]);r.dxfGroup.add(new o.rb(l,c))}else if("LWPOLYLINE"===e.type&&null!==(n=e.vertices)&&void 0!==n&&n.length){var d=new o.qb({color:255}),h=(new o.p).setFromPoints(e.vertices.map(function(e){return new o.Jd(e.x,e.y,0)}));r.dxfGroup.add(new o.pb(h,d))}}),this.scene.add(this.dxfGroup);var n=(new o.m).setFromObject(this.dxfGroup),c=n.getCenter(new o.Jd),d=n.getSize(new o.Jd);this.dxfGroup.position.set(-c.x,-c.y,0);var h=Math.max(d.x||1,d.y||1),f=this.camera.fov*(Math.PI/180),v=Math.abs(h/(2*Math.tan(f/2)));this.camera.position.set(0,0,v+10),this.camera.lookAt(new o.Jd(0,0,0)),this.renderOnce()}catch(e){this.error=e.message}},renderOnce:function(){this.renderer&&this.scene&&this.camera&&this.renderer.render(this.scene,this.camera)}}},h=(t(756),t(32)),component=Object(h.a)(d,function(){var e=this,r=e._self._c;return r("div",{staticClass:"w-full h-full relative"},[r("canvas",{ref:"canvas",staticClass:"w-full h-full block"}),e._v(" "),e.error?r("div",{staticClass:"absolute inset-x-0 bottom-2 text-center text-red-600 text-sm"},[e._v("\n    DXF ֆայլը բեռնելիս սխալ՝ "+e._s(e.error)+"\n  ")]):e._e()])},[],!1,null,"18448b4c",null);r.default=component.exports}}]);