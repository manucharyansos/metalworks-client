(window.webpackJsonp=window.webpackJsonp||[]).push([[57,12,21,26,30],{466:function(e,t,r){"use strict";r.r(t);r(190);var n={name:"InputWithLabelIcon",props:{label:{type:String,default:""},label_Id:{type:String,default:""},for_LAbel:{type:String,default:""},type:{type:String,default:""},value:{type:[String,Array,Number],default:""},placeholder:{type:String,default:""},classes:{type:String,default:""},label_class:{type:[String,Object],default:""},disabled:{type:Boolean,default:!1}}},l=r(11),component=Object(l.a)(n,function(){var e=this,t=e._self._c;return t("div",{staticClass:"relative"},[t("span",{staticClass:"absolute start-1 bottom-3 text-gray-500 dark:text-gray-400"},[e._t("label_svg")],2),e._v(" "),t("input",{staticClass:"block py-2.5 ps-6 pe-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer",class:e.classes,attrs:{id:e.label_Id,type:e.type,placeholder:e.placeholder,disabled:e.disabled},domProps:{value:e.value},on:{input:function(t){return e.$emit("input",t.target.value)}}}),e._v(" "),t("label",{staticClass:"absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-6 scale-75 top-2 z-10 origin-[0] start-0 peer-focus:text-blue-600 peer-focus:dark:text-blue-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6 rtl:peer-focus:translate-x-1/4 rtl:peer-focus:left-auto",class:e.label_class,attrs:{for:e.for_LAbel}},[e._v("\n    "+e._s(e.label)+"\n  ")])])},[],!1,null,"faa5144a",null);t.default=component.exports},471:function(e,t,r){var content=r(501);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(36).default)("dbf01c20",content,!0,{sourceMap:!1})},500:function(e,t,r){"use strict";r(471)},501:function(e,t,r){var n=r(35)(function(i){return i[1]});n.push([e.i,"canvas{background-color:#fff;border:1px solid #ccc;display:block;margin:auto}.line-color{stroke:#000}.error-message{color:red;margin-top:10px;text-align:center}",""]),n.locals={},e.exports=n},502:function(e,t,r){"use strict";r.r(t);var n=r(0),l=(r(9),r(43),r(25),r(6),r(26),r(457)),o=r(507),c=r(512),d={props:{dxfUrl:{type:String,required:!0}},data:function(){return{scene:null,camera:null,renderer:null,dxfGroup:null,error:null}},watch:{dxfUrl:function(){this.loadDxfFile()}},mounted:function(){this.initThreeJS(),this.loadDxfFile()},beforeDestroy:function(){this.cleanupThreeJS()},methods:{initThreeJS:function(){this.scene=new l.ad,this.camera=new l.cc(75,this.$refs.canvas.clientWidth/this.$refs.canvas.clientHeight,.1,1e3),this.renderer=new o.a({canvas:this.$refs.canvas,antialias:!0}),this.renderer.setClearColor(16777215,1),this.renderer.setSize(this.$refs.canvas.clientWidth,this.$refs.canvas.clientHeight)},cleanupThreeJS:function(){this.renderer&&this.renderer.dispose(),this.scene&&(this.scene.traverse(function(object){(object.isMesh||object.isLine)&&(object.geometry&&object.geometry.dispose(),object.material&&(Array.isArray(object.material)?object.material.forEach(function(e){return e.dispose()}):object.material.dispose()))}),this.scene.clear()),this.dxfGroup&&(this.dxfGroup.traverse(function(object){(object.isMesh||object.isLine)&&(object.geometry&&object.geometry.dispose(),object.material&&(Array.isArray(object.material)?object.material.forEach(function(e){return e.dispose()}):object.material.dispose()))}),this.dxfGroup.clear())},loadDxfFile:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark(function t(){var r,n,l,o,c,d;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=1,e.$axios.get("/api/factories/getFile/".concat(e.dxfUrl));case 1:if(200===(r=t.sent).status){t.next=2;break}throw new Error("HTTP սխալ: Կոդը ".concat(r.status));case 2:if((n=r.data)&&n.content){t.next=3;break}throw new Error("Ֆայլի տվյալները բացակայում են պատասխանում։");case 3:try{o=atob(n.content),c=JSON.parse(o),l=c.content?atob(c.content):o}catch(e){l=atob(n.content)}e.parseDxf(l),e.error=null,t.next=5;break;case 4:t.prev=4,d=t.catch(0),console.error("DXF ֆայլը բեռնելիս սխալ:",d),e.error=d.message;case 5:case"end":return t.stop()}},t,null,[[0,4]])}))()},parseDxf:function(e){var t=this;try{var r=(new c.a).parseSync(e);if(!r||!r.entities)throw new Error("DXF ֆայլը մշակելիս սխալ կամ տվյալներ չեն գտնվել։");this.dxfGroup&&(this.scene.remove(this.dxfGroup),this.dxfGroup=null),this.dxfGroup=new l.ab,r.entities.forEach(function(e){var r,n;if("LINE"===e.type){n=new l.jb({color:0}),r=(new l.n).setFromPoints([new l.wd(e.vertices[0].x,e.vertices[0].y,0),new l.wd(e.vertices[1].x,e.vertices[1].y,0)]);var line=new l.kb(r,n);t.dxfGroup.add(line)}else if("LWPOLYLINE"===e.type){n=new l.jb({color:255}),r=(new l.n).setFromPoints(e.vertices.map(function(e){return new l.wd(e.x,e.y,0)}));var polyline=new l.ib(r,n);t.dxfGroup.add(polyline)}}),this.scene.add(this.dxfGroup);var n=(new l.k).setFromObject(this.dxfGroup),o=n.getCenter(new l.wd),d=n.getSize(new l.wd);this.dxfGroup.position.set(-o.x,-o.y,0);var f=Math.max(d.x,d.y),h=this.camera.fov*(Math.PI/180),v=Math.abs(f/(2*Math.tan(h/2)));this.camera.position.set(0,0,v+10),this.camera.lookAt(new l.wd(0,0,0)),this.renderer.render(this.scene,this.camera)}catch(e){this.error=e.message}}}},f=(r(500),r(11)),component=Object(f.a)(d,function(){var e=this,t=e._self._c;return t("div",[t("canvas",{ref:"canvas",staticClass:"line-color w-full h-full flex items-center justify-center"}),e._v(" "),e.error?t("div",{staticClass:"error-message"},[e._v("\n    DXF ֆայլը բեռնելիս սխալ՝ "+e._s(e.error)+"\n  ")]):e._e()])},[],!1,null,null,null);t.default=component.exports},509:function(e,t,r){var content=r(529);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(36).default)("f279fbf8",content,!0,{sourceMap:!1})},528:function(e,t,r){"use strict";r(509)},529:function(e,t,r){var n=r(35)(function(i){return i[1]});n.push([e.i,".fade-enter-active[data-v-425c4a72],.fade-leave-active[data-v-425c4a72]{transition:opacity .2s ease}.fade-enter-from[data-v-425c4a72],.fade-leave-to[data-v-425c4a72]{opacity:0}.zoom-enter-active[data-v-425c4a72],.zoom-leave-active[data-v-425c4a72]{transition:transform .18s ease,opacity .18s ease}.zoom-enter-from[data-v-425c4a72],.zoom-leave-to[data-v-425c4a72]{opacity:0;transform:scale(.98)}",""]),n.locals={},e.exports=n},550:function(e,t,r){var content=r(601);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(36).default)("1d279130",content,!0,{sourceMap:!1})},570:function(e,t,r){"use strict";r.r(t);var n={name:"PopupModal",props:{isOpenModal:{type:Boolean,default:!1},text:{type:String,default:""}}},l=r(11),component=Object(l.a)(n,function(){var e=this,t=e._self._c;return t("div",[e.isOpenModal?t("div",{staticClass:"fixed inset-0 bg-black bg-opacity-50 z-40"}):e._e(),e._v(" "),e.isOpenModal?t("div",{staticClass:"overflow-y-auto overflow-x-hidden fixed flex items-center justify-center z-50 w-full md:inset-0 h-[calc(100%-1rem)] max-h-full",attrs:{tabindex:"-1"}},[t("div",{staticClass:"relative p-4 w-full max-w-md max-h-full"},[t("div",{staticClass:"relative bg-white rounded-lg shadow-sm dark:bg-gray-700"},[t("button",{staticClass:"absolute top-3 end-2.5 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white",attrs:{type:"button"},on:{click:function(t){return e.$emit("closeModal")}}},[t("svg",{staticClass:"w-3 h-3",attrs:{"aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 14 14"}},[t("path",{attrs:{stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"}})]),e._v(" "),t("span",{staticClass:"sr-only"},[e._v("Close modal")])]),e._v(" "),t("div",{staticClass:"p-4 md:p-5 text-center"},[t("svg",{staticClass:"mx-auto mb-4 text-gray-400 w-12 h-12 dark:text-gray-200",attrs:{"aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 20 20"}},[t("path",{attrs:{stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 11V6m0 8h.01M19 10a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}})]),e._v(" "),t("h3",{staticClass:"mb-5 text-lg font-normal text-gray-500 dark:text-gray-400"},[e._v("\n            "+e._s(e.text)+"\n          ")]),e._v(" "),t("button",{staticClass:"text-white bg-red-600 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-red-300 dark:focus:ring-red-800 font-medium rounded-lg text-sm inline-flex items-center px-5 py-2.5 text-center",attrs:{type:"button"},on:{click:function(t){return e.$emit("confirm")}}},[e._v("\n            Այո ջնջել\n          ")]),e._v(" "),t("button",{staticClass:"py-2.5 px-5 ms-3 text-sm font-medium text-gray-900 focus:outline-none bg-white rounded-lg border border-gray-200 hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-4 focus:ring-gray-100 dark:focus:ring-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-700",attrs:{type:"button"},on:{click:function(t){return e.$emit("closeModal")}}},[e._v("\n            Ոչ, չեղարկել\n          ")])])])])]):e._e()])},[],!1,null,null,null);t.default=component.exports},571:function(e,t,r){"use strict";r.r(t);r(37),r(18),r(192);var n={name:"AddFileModal",props:{isOpenModal:{type:Boolean,default:!1},text:{type:String,default:""},isDxfFile:{type:Boolean,default:!1},file:{type:Object,default:function(){return{name:"",size:0}}}},computed:{hasFile:function(){var e;return!(null===(e=this.file)||void 0===e||!e.name)},fileName:function(){var e;return(null===(e=this.file)||void 0===e?void 0:e.name)||""},fileSize:function(){var e,t=(null===(e=this.file)||void 0===e?void 0:e.size)||0;if(0===t)return"0 Bytes";var i=Math.floor(Math.log(t)/Math.log(1024));return"".concat(parseFloat((t/Math.pow(1024,i)).toFixed(2))," ").concat(["Bytes","KB","MB","GB"][i])}},methods:{onDrop:function(e){var t,r=null===(t=e.dataTransfer)||void 0===t||null===(t=t.files)||void 0===t?void 0:t[0];r&&this.$emit("dropped",r)}}},l=(r(528),r(11)),component=Object(l.a)(n,function(){var e=this,t=e._self._c;return t("div",[t("transition",{attrs:{name:"fade"}},[e.isOpenModal?t("div",{staticClass:"fixed inset-0 bg-black/50 z-40",attrs:{"aria-hidden":"true"}}):e._e()]),e._v(" "),t("transition",{attrs:{name:"zoom"}},[e.isOpenModal?t("div",{staticClass:"fixed inset-0 z-50 flex items-center justify-center p-4",attrs:{role:"dialog","aria-modal":"true"}},[t("div",{staticClass:"relative w-full max-w-4xl max-h-[90vh] bg-white rounded-2xl shadow-2xl flex flex-col overflow-hidden"},[t("button",{staticClass:"absolute top-4 right-4 z-40 text-gray-600 hover:text-gray-800 transition-colors bg-white rounded-full p-2 shadow-sm",attrs:{type:"button","aria-label":"Close"},on:{click:function(t){return e.$emit("closeModal")}}},[t("svg",{staticClass:"w-5 h-5",attrs:{viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[t("path",{attrs:{d:"M1 1l12 12M13 1L1 13",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"}})])]),e._v(" "),t("div",{staticClass:"flex-1 p-5 sm:p-6 md:p-8 flex flex-col items-stretch gap-6 overflow-y-auto"},[e.isDxfFile?t("div",{staticClass:"grid grid-cols-1 md:grid-cols-3 gap-4"},[t("div",{staticClass:"bg-gray-50 rounded-lg p-4"},[e._t("quantity")],2),e._v(" "),t("div",{staticClass:"bg-gray-50 rounded-lg p-4"},[e._t("materialType")],2),e._v(" "),t("div",{staticClass:"bg-gray-50 rounded-lg p-4"},[e._t("thickness")],2)]):e._e(),e._v(" "),t("label",{staticClass:"w-full max-w-2xl mx-auto cursor-pointer",on:{dragover:function(e){e.preventDefault()},drop:function(t){return t.preventDefault(),e.onDrop.apply(null,arguments)}}},[t("div",{staticClass:"border-2 border-dashed rounded-xl p-8 text-center transition-colors",class:e.hasFile?"border-green-500":"border-gray-300 hover:border-blue-500"},[t("div",{staticClass:"flex flex-col items-center justify-center gap-2"},[t("svg",{staticClass:"h-10 w-10",class:e.hasFile?"text-green-500":"text-gray-400",attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"}},[t("path",{attrs:{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6h.1a5 5 0 011 9.9M15 13l-3-3-3 3m3-3v12"}})]),e._v(" "),e.hasFile?[t("div",{staticClass:"flex items-center text-green-700 font-medium"},[t("svg",{staticClass:"h-5 w-5 mr-1",attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"}},[t("path",{attrs:{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"}})]),e._v("\n                    "+e._s(e.fileName)+"\n                  ")]),e._v(" "),t("div",{staticClass:"text-sm text-gray-500"},[e._v(e._s(e.fileSize))])]:[t("span",{staticClass:"text-gray-700 font-medium"},[e._v("Սեղմեք՝ ֆայլ ընտրելու համար")]),e._v(" "),t("span",{staticClass:"text-xs text-gray-500"},[e._v("կամ տեղափոխեք ֆայլը այստեղ")])]],2),e._v(" "),e._t("file-input")],2)]),e._v(" "),t("p",{staticClass:"text-center text-gray-600 text-sm"},[e._v(e._s(e.text))])]),e._v(" "),t("div",{staticClass:"bg-gray-50 px-4 sm:px-6 py-3 flex justify-center gap-3"},[t("button",{staticClass:"px-5 py-2.5 bg-green-600 hover:bg-green-700 text-white font-medium rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2",attrs:{type:"button"},on:{click:function(t){return e.$emit("createFile")}}},[e._v("\n            Ավելացնել ֆայլ\n          ")]),e._v(" "),t("button",{staticClass:"px-5 py-2.5 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2",attrs:{type:"button"},on:{click:function(t){return e.$emit("closeModal")}}},[e._v("\n            Մաքրել\n          ")])])])]):e._e()])],1)},[],!1,null,"425c4a72",null);t.default=component.exports},600:function(e,t,r){"use strict";r(550)},601:function(e,t,r){var n=r(35)(function(i){return i[1]});n.push([e.i,".slide-down-enter-active[data-v-428be14b]{transition:all .3s ease}.slide-down-enter-from[data-v-428be14b],.slide-down-leave-to[data-v-428be14b]{opacity:0;transform:translateY(-6px)}",""]),n.locals={},e.exports=n},659:function(e,t,r){"use strict";r.r(t);r(19),r(42),r(29),r(30),r(25),r(26);var n=r(0),l=r(10),o=(r(9),r(37),r(20),r(95),r(53),r(44),r(113),r(18),r(6),r(23),r(60),r(27),r(61),r(28),r(31)),c=r(502),d=r(570),f=r(571);function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function v(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h(Object(r),!0).forEach(function(t){Object(l.a)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var m={name:"EngineerFilesView",components:{InputWithLabelIcon:r(466).default,AddFileModal:f.default,PopupModal:d.default,DxfViewer:c.default},layout:"EngineerLayout",middleware:["engineer","roleRedirect"],data:function(){return{loadingFactoryId:null,loading:!1,isOpen:"remote_number",isOpenFiles:"files_by_id",id:"",dxfUrl:"",fileType:null,selectedFactoryId:null,selectedRemoteNumber:null,selectedRemoteNumberId:null,selectedFiles:[],selectedFile:null,breadcrumb:[],hoveredFileId:null,isOpenModal:!1,isOpenAddFileModal:!1,isDxfFile:!1,isSelectedMaterials:!1,fileData:{quantity:null,material:"",thickness:"",file:null},currentFile:{name:"",size:0},toDeleteId:null}},computed:v(v(v(v({},Object(o.c)("pmp",["getPmp","errorMessage"])),Object(o.c)("factory",["getFactory"])),Object(o.c)("materials",["getMaterials"])),{},{materials:function(){return this.getMaterials||[]},filteredMaterials:function(){if(!this.fileData.material)return this.materials;var q=this.fileData.material.toLowerCase();return this.materials.filter(function(e){return(e.description||"").toLowerCase().includes(q)})}}),created:function(){var e=this;this.id=this.$route.query.id,this.id?(this.loading=!0,Promise.all([this.fetchPmp(this.id),this.fetchFactory()]).catch(function(t){e.$notify({text:String(t),duration:3e3,speed:1e3,position:"top",type:"error"})}).finally(function(){e.loading=!1})):this.$notify({text:"Հաշվի ID-ն բացակայում է: Խնդրում ենք ստուգել URL-ը:",duration:3e3,speed:1e3,position:"top",type:"error"})},methods:v(v(v(v({},Object(o.b)("pmp",["fetchPmp","deleteFile","createPmpFilesByFactory"])),Object(o.b)("factory",["fetchFactory","downloadUploadedFile"])),Object(o.b)("materials",["fetchMaterials"])),{},{openMaterials:function(){var e=this;this.loading=!0,this.fetchMaterials().then(function(){e.isSelectedMaterials=!e.isSelectedMaterials}).catch(function(t){e.$notify({text:String(t),duration:3e3,speed:1e3,position:"top",type:"error"})}).finally(function(){e.loading=!1})},selectMaterial:function(e){this.fileData.material=e.description,this.fileData.thickness=e.thickness,this.isSelectedMaterials=!1},showButton:function(e){this.hoveredFileId=e},hideButton:function(e){this.hoveredFileId===e&&(this.hoveredFileId=null)},showFiles:function(e){var t;this.isOpen="factories",this.selectedRemoteNumber=e,this.selectedRemoteNumberId=e.id,this.selectedFiles=(this.getPmp.files||[]).filter(function(t){return t.remote_number_id===e.id}),this.dxfUrl="",this.fileType=null,this.selectedFile=null,this.isDxfFile=!1,this.resetFileFields(),this.breadcrumb=[(null===(t=this.getPmp)||void 0===t?void 0:t.group_name)||"PMP",e.remote_number_name]},selectFactory:function(e){var t=this;this.isDxfFile="DXF"===e.value,this.loadingFactoryId=e.id,this.loading=!0;try{this.isOpenFiles=this.isOpenFiles===e.id?null:e.id,this.selectedFactoryId=e.id,this.selectedFiles=(this.getPmp.files||[]).filter(function(r){return r.factory_id===e.id&&r.remote_number_id===t.selectedRemoteNumberId}),this.dxfUrl="",this.fileType=null,this.selectedFile=null,this.breadcrumb.length>1?this.breadcrumb.splice(1,1,e.value):this.breadcrumb.push(e.value)}finally{this.loadingFactoryId=null,this.loading=!1}},handleFileChange:function(e){var t,r=null===(t=e.target.files)||void 0===t?void 0:t[0];r?(this.currentFile={name:r.name,size:r.size},this.fileData.file=r):(this.currentFile={name:"",size:0},this.fileData.file=null)},addFile:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark(function t(){var r,n,l,o,c,d,f,h,v,m;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.fileData,n=r.file,l=r.quantity,o=r.material,c=r.thickness,!(d=e.isDxfFile)){t.next=2;break}if(n&&l&&o&&c){t.next=1;break}return e.$notify({text:"DXF-ի համար բոլոր դաշտերը պարտադիր են՝ ֆայլ, քանակ, նյութ",duration:3e3,speed:1e3,position:"top",type:"warning"}),t.abrupt("return");case 1:t.next=3;break;case 2:if(n){t.next=3;break}return e.$notify({text:"Խնդրում ենք ընտրել ֆայլ",duration:3e3,speed:1e3,position:"top",type:"warning"}),t.abrupt("return");case 3:return e.loading=!0,(f=new FormData).append("file",n),f.append("pmp_id",e.getPmp.id),f.append("remote_number_id",e.selectedRemoteNumberId),f.append("factory_id",e.selectedFactoryId),d&&(f.append("quantity",l),f.append("material_type",o),f.append("thickness",c)),t.prev=4,t.next=5,e.createPmpFilesByFactory(f);case 5:if(!t.sent){t.next=7;break}return e.$notify({text:"Ֆայլը հաջողությամբ ավելացվեց",duration:3e3,speed:1e3,position:"top",type:"success"}),t.next=6,e.fetchPmp(e.id);case 6:e.selectedFiles=(e.getPmp.files||[]).filter(function(t){return t.remote_number_id===e.selectedRemoteNumberId&&t.factory_id===e.selectedFactoryId}),e.isOpenAddFileModal=!1,e.resetFileFields(),t.next=8;break;case 7:m=(null===(h=e.errorMessage)||void 0===h?void 0:h.error)||(null===(v=e.errorMessage)||void 0===v||null===(v=v.error)||void 0===v?void 0:v.message)||"Սխալ",e.$notify({text:m,duration:3e3,speed:1e3,position:"top",type:"error"});case 8:return t.prev=8,e.loading=!1,t.finish(8);case 9:case"end":return t.stop()}},t,null,[[4,,8,9]])}))()},viewFile:function(e,t){this.breadcrumb.includes(t.original_name)||(this.breadcrumb.length>2&&this.breadcrumb.pop(),this.breadcrumb.push(t.original_name)),this.selectedFile=t,this.dxfUrl=e,this.isOpenFiles=t.factory_id,this.isDxfFile=t.factory_id===this.selectedFactoryId&&this.isDxfFile,this.fileType=this.getFileType(t.original_name||e)},downloadFile:function(e){var t=this;return Object(n.a)(regeneratorRuntime.mark(function r(){var n;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(e&&"string"==typeof e.path){r.next=1;break}return t.$notify({text:"Ֆայլի ներբեռնումը ձախողվեց:",duration:3e3,speed:1e3,position:"top",type:"error"}),r.abrupt("return");case 1:return n=String(e.path).replace(/\\/g,"/"),r.next=2,t.downloadUploadedFile({path:n,original_name:e.original_name||"downloaded_file"});case 2:case"end":return r.stop()}},r)}))()},fileUrl:function(e){if(!e||"string"!=typeof e)return null;var t=this.$axios.defaults.baseURL;return"".concat(t,"/storage/").concat(e)},getFileType:function(e){if(!e||"string"!=typeof e)return null;var t=e.toLowerCase().split(".").pop();return"dxf"===t?"dxf":"pdf"===t?"pdf":["jpg","jpeg","png","eps"].includes(t)?"image":["step","sldprt","sldasm","slddrw","solid"].includes(t)?"cad":null},openDelete:function(e){this.toDeleteId=e,this.isOpenModal=!0},deleteDxfFile:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.toDeleteId){t.next=1;break}return t.abrupt("return");case 1:return e.loading=!0,t.prev=2,t.next=3,e.deleteFile(e.toDeleteId);case 3:if(!t.sent){t.next=5;break}return t.next=4,e.fetchPmp(e.id);case 4:e.selectedFile&&e.selectedFile.id===e.toDeleteId&&(e.selectedFile=null,e.dxfUrl="",e.fileType=null),e.selectedFiles=e.selectedFiles.filter(function(t){return t.id!==e.toDeleteId}),e.$notify({text:"Ֆայլը ջնջվեց",duration:2500,speed:800,position:"top",type:"success"});case 5:return t.prev=5,e.isOpenModal=!1,e.toDeleteId=null,e.loading=!1,t.finish(5);case 6:case"end":return t.stop()}},t,null,[[2,,5,6]])}))()},openAddFileModal:function(){this.isOpenAddFileModal=!this.isOpenAddFileModal,this.isOpenAddFileModal||this.resetFileFields()},resetFileFields:function(){this.fileData={quantity:null,material:"",thickness:"",file:null},this.currentFile={name:"",size:0},this.isSelectedMaterials=!1},closeModal:function(){this.isOpenModal=!1,this.toDeleteId=null},selectBreadcrumb:function(e){var t=this;if(this.breadcrumb=this.breadcrumb.slice(0,e+1),0===e)this.isOpen="remote_number",this.selectedFactoryId=null,this.selectedRemoteNumberId=null,this.dxfUrl=null,this.fileType=null,this.selectedFiles=[],this.selectedFile=null,this.isDxfFile=!1,this.resetFileFields();else if(1===e){this.isOpen="factories",this.dxfUrl=null,this.fileType=null,this.selectedFile=null,this.isDxfFile=!1,this.resetFileFields();var title=this.breadcrumb[1],r=(this.getPmp.remote_number||[]).find(function(e){return e.remote_number_name===title});r&&(this.selectedRemoteNumberId=r.id,this.selectedFiles=(this.getPmp.files||[]).filter(function(e){return e.remote_number_id===t.selectedRemoteNumberId}))}else if(2===e){this.isOpen="files_by_id";var n=this.breadcrumb[2],l=(this.getFactory||[]).find(function(e){return e.value===n});l&&(this.selectedFactoryId=l.id,this.isDxfFile="DXF"===l.value,this.selectedFiles=(this.getPmp.files||[]).filter(function(e){return e.factory_id===t.selectedFactoryId}),this.dxfUrl=null,this.fileType=null,this.selectedFile=null,this.resetFileFields())}},hasFiles:function(e){return(this.getPmp.files||[]).some(function(t){return t.factory_id===e})}})},x=(r(600),r(11)),component=Object(x.a)(m,function(){var e,t,r,n=this,l=n._self._c;return l("main",{staticClass:"p-4 flex flex-col gap-3 relative"},[n.loading?l("div",{staticClass:"fixed inset-0 bg-gray-200/60 flex items-center justify-center z-50"},[l("svg",{staticClass:"w-8 h-8 text-blue-500 animate-spin",attrs:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"}},[l("circle",{staticClass:"opacity-25",attrs:{cx:"12",cy:"12",r:"10","stroke-width":"2"}}),n._v(" "),l("path",{staticClass:"opacity-75",attrs:{d:"M4 12a8 8 0 018-8","stroke-width":"2"}})])]):n._e(),n._v(" "),n.breadcrumb.length?l("nav",{staticClass:"w-full"},[l("ol",{staticClass:"flex flex-wrap items-center gap-1 text-sm text-gray-700"},n._l(n.breadcrumb,function(e,t){return l("li",{key:t,staticClass:"flex items-center"},[l("button",{staticClass:"inline-flex items-center gap-1 px-1.5 py-1 hover:text-blue-600",on:{click:function(e){return n.selectBreadcrumb(t)}}},[0===t?l("span",{staticClass:"sr-only"},[n._v("Գլխավոր")]):n._e(),n._v(" "),0!==t?l("svg",{staticClass:"w-3 h-3 text-gray-400",attrs:{viewBox:"0 0 6 10",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[l("path",{attrs:{d:"M1 9l4-4-4-4",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})]):n._e(),n._v(" "),l("span",{staticClass:"truncate max-w-[40vw] sm:max-w-[60vw]"},[n._v(n._s(e))])])])}),0)]):n._e(),n._v(" "),l("div",{staticClass:"grid grid-cols-1 lg:grid-cols-[320px_1fr] gap-6"},[l("aside",{staticClass:"lg:border-r lg:border-gray-200 lg:pr-6 lg:min-h-[70vh]"},["remote_number"===n.isOpen?l("section",{staticClass:"flex flex-col gap-2"},n._l(n.getPmp.remote_number,function(e){return l("button",{key:e.id,staticClass:"grid grid-cols-[64px_1fr] gap-3 items-center border border-gray-200 rounded-lg p-2 text-left hover:shadow-sm",on:{click:function(t){return n.showFiles(e)}}},[l("img",{staticClass:"w-16 h-16 object-contain",attrs:{src:"/dxf.png",alt:"DXF"}}),n._v(" "),l("div",{staticClass:"truncate"},[l("div",{staticClass:"font-medium"},[n._v(n._s(e.remote_number))]),n._v(" "),l("div",{staticClass:"text-gray-600 truncate"},[n._v(n._s(e.remote_number_name))])])])}),0):"factories"===n.isOpen?l("section",{staticClass:"flex flex-col gap-2"},n._l(n.getFactory,function(e){return l("div",{key:e.id},[l("button",{staticClass:"w-full border border-gray-200 rounded-lg p-2 flex items-center justify-between hover:bg-gray-50",class:{"bg-gray-900 text-white hover:bg-gray-900":n.selectedFactoryId===e.id,"bg-gray-600 text-white":n.hasFiles(e.id)},attrs:{disabled:n.loading},on:{click:function(t){return n.selectFactory(e)}}},[l("span",{staticClass:"truncate"},[n._v(n._s(e.value))]),n._v(" "),n.loadingFactoryId===e.id?l("span",[l("svg",{staticClass:"w-4 h-4 animate-spin",attrs:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"}},[l("circle",{staticClass:"opacity-25",attrs:{cx:"12",cy:"12",r:"10","stroke-width":"4"}}),n._v(" "),l("path",{staticClass:"opacity-75",attrs:{d:"M4 12a8 8 0 018-8","stroke-width":"4"}})])]):n.hasFiles(e.id)?l("span",{staticClass:"text-green-400"},[n._v("✔")]):n._e()]),n._v(" "),l("transition",{attrs:{name:"slide-down"}},[l("div",{directives:[{name:"show",rawName:"v-show",value:n.isOpenFiles===e.id,expression:"isOpenFiles === factory.id"}],staticClass:"mt-3 flex flex-col gap-2"},[n._l(n.selectedFiles,function(e){return l("div",{key:e.id,staticClass:"flex items-center justify-between border border-gray-200 rounded-lg p-2 hover:bg-gray-50",on:{mouseenter:function(t){return n.showButton(e.id)},mouseleave:function(t){return n.hideButton(e.id)}}},[l("button",{staticClass:"truncate text-left max-w-[220px]",on:{click:function(t){return n.viewFile(e.path,e)}}},[n._v("\n                  "+n._s(e.original_name)+"\n                ")]),n._v(" "),l("div",{staticClass:"flex items-center gap-3"},[l("button",{staticClass:"text-sm text-blue-600 hover:underline",on:{click:function(t){return t.preventDefault(),n.downloadFile(e)}}},[n._v("Ներբեռնել")]),n._v(" "),n.hoveredFileId===e.id?l("button",{staticClass:"text-red-600",on:{click:function(t){return n.openDelete(e.id)}}},[n._v("Ջնջել")]):n._e()])])}),n._v(" "),l("div",{staticClass:"mt-4"},[l("button",{staticClass:"w-full bg-green-600 hover:bg-green-700 text-white rounded-lg py-2 flex justify-center items-center",attrs:{disabled:n.loading},on:{click:n.openAddFileModal}},[n.loading?l("svg",{staticClass:"w-4 h-4 animate-spin",attrs:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"}},[l("circle",{staticClass:"opacity-25",attrs:{cx:"12",cy:"12",r:"10","stroke-width":"4"}}),n._v(" "),l("path",{staticClass:"opacity-75",attrs:{d:"M4 12a8 8 0 018-8","stroke-width":"4"}})]):l("span",[n._v("Ավելացնել ֆայլ")])]),n._v(" "),l("AddFileModal",{attrs:{"is-open-modal":n.isOpenAddFileModal,file:n.currentFile,"is-dxf-file":n.isDxfFile,text:"Ընտրեք ֆայլը և լրացրեք դաշտերը"},on:{closeModal:n.openAddFileModal,createFile:n.addFile},scopedSlots:n._u([{key:"file-input",fn:function(){return[l("input",{staticClass:"hidden",attrs:{type:"file",disabled:n.loading},on:{change:n.handleFileChange}})]},proxy:!0},n.isDxfFile?{key:"quantity",fn:function(){return[l("InputWithLabelIcon",{attrs:{type:"number",name:"quantity",label:"Քանակ լրակազմում",disabled:n.loading,min:"1"},model:{value:n.fileData.quantity,callback:function(e){n.$set(n.fileData,"quantity",e)},expression:"fileData.quantity"}})]},proxy:!0}:null,n.isDxfFile?{key:"materialType",fn:function(){return[l("div",{staticClass:"relative"},[l("InputWithLabelIcon",{attrs:{type:"text",name:"materialType",label:"Նյութ",disabled:n.loading},on:{focus:n.openMaterials},model:{value:n.fileData.material,callback:function(e){n.$set(n.fileData,"material",e)},expression:"fileData.material"}}),n._v(" "),l("button",{staticClass:"absolute inset-y-0 right-0 px-3 text-gray-500",attrs:{type:"button",disabled:n.loading},on:{click:n.openMaterials}},[n._v("▼")]),n._v(" "),n.isSelectedMaterials?l("div",{staticClass:"absolute z-10 mt-1 w-full bg-white rounded-md shadow-lg border border-gray-200 max-h-60 overflow-auto"},[l("ul",{staticClass:"py-1"},n._l(n.filteredMaterials,function(e){return l("li",{key:e.id,staticClass:"px-4 py-2 hover:bg-blue-50 cursor-pointer",on:{click:function(t){return n.selectMaterial(e)}}},[n._v("\n                            "+n._s(e.description)+"\n                          ")])}),0)]):n._e()],1)]},proxy:!0}:null,n.isDxfFile?{key:"thickness",fn:function(){return[l("InputWithLabelIcon",{attrs:{type:"text",name:"thickness",label:"Հաստություն",disabled:n.loading},model:{value:n.fileData.thickness,callback:function(e){n.$set(n.fileData,"thickness",e)},expression:"fileData.thickness"}})]},proxy:!0}:null],null,!0)}),n._v(" "),l("PopupModal",{attrs:{"is-open-modal":n.isOpenModal,text:"Վստահ եք, որ ուզում եք ջնջել՞"},on:{"close-modal":n.closeModal,confirm:n.deleteDxfFile}})],1)],2)])],1)}),0):n._e()]),n._v(" "),l("section",{staticClass:"min-h-[50vh]"},[n.selectedFile&&n.isDxfFile?l("div",{staticClass:"border border-gray-200 rounded-lg p-4 mb-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3"},[l("div",[n._v("Քանակ․ "),l("b",[n._v(n._s(null===(e=n.selectedFile)||void 0===e?void 0:e.quantity))])]),n._v(" "),l("div",[n._v("Նյութ․ "),l("b",[n._v(n._s(null===(t=n.selectedFile)||void 0===t?void 0:t.material_type))])]),n._v(" "),l("div",[n._v("Հաստություն․ "),l("b",[n._v(n._s(null===(r=n.selectedFile)||void 0===r?void 0:r.thickness))])])]):n._e(),n._v(" "),n.selectedFile?l("div",{staticClass:"flex flex-col items-center"},[l("p",{staticClass:"my-4 text-center font-medium break-words"},[n._v(n._s(n.selectedFile.original_name))]),n._v(" "),"dxf"===n.fileType&&n.dxfUrl?l("DxfViewer",{key:n.dxfUrl,staticClass:"w-full max-w-[920px]",attrs:{"dxf-url":n.dxfUrl}}):n._e(),n._v(" "),"pdf"===n.fileType?l("div",{staticClass:"w-full"},[l("embed",{staticClass:"w-full min-h-[60vh] border rounded",attrs:{src:n.fileUrl(n.selectedFile.path),type:"application/pdf"}}),n._v(" "),l("a",{staticClass:"mt-2 inline-block bg-gray-800 text-white rounded px-4 py-1",attrs:{href:n.fileUrl(n.selectedFile.path),target:"_blank"}},[n._v("Բացել նոր պատուհանում")])]):n._e(),n._v(" "),"image"===n.fileType?l("div",{staticClass:"w-full flex justify-center"},[l("a",{attrs:{href:n.fileUrl(n.selectedFile.path),target:"_blank"}},[l("img",{staticClass:"max-w-full max-h-[70vh] object-contain rounded",attrs:{src:n.fileUrl(n.selectedFile.path),alt:n.selectedFile.original_name}})])]):n._e(),n._v(" "),"cad"===n.fileType?l("div",{staticClass:"text-center"},[l("p",{staticClass:"text-gray-600"},[n._v(n._s(n.selectedFile.original_name)+" ("+n._s(n.fileType.toUpperCase())+" ֆայլ)")]),n._v(" "),l("a",{staticClass:"mt-2 inline-block bg-gray-800 text-white rounded px-4 py-1",attrs:{href:n.fileUrl(n.selectedFile.path),download:n.selectedFile.original_name}},[n._v("Ներբեռնել")])]):n._e()],1):n._e()])]),n._v(" "),l("notifications")],1)},[],!1,null,"428be14b",null);t.default=component.exports}}]);