(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{463:function(t,e,r){"use strict";var l=r(3),o=r(282).trim;l({target:"String",proto:!0,forced:r(464)("trim")},{trim:function(){return o(this)}})},464:function(t,e,r){"use strict";var l=r(112).PROPER,o=r(5),n=r(283);t.exports=function(t){return o(function(){return!!n[t]()||"​᠎"!=="​᠎"[t]()||l&&n[t].name!==t})}},534:function(t,e,r){"use strict";r.r(e);r(19),r(42),r(37),r(53),r(44),r(60),r(463),r(20),r(46),r(114),r(43),r(113),r(6),r(23),r(32),r(27),r(61),r(26);var l={name:"WorkFormModal",props:{visible:{type:Boolean,default:!1},work:{type:Object,default:null},submitting:{type:Boolean,default:!1}},data:function(){return{form:{title:"",slug:"",description:"",tagsText:"",is_published:!0,sort_order:100},mainFile:null,mainPreview:null,newGallery:[],galleryPreviews:[],existingGallery:[],deletedIds:[]}},computed:{isEdit:function(){return!(!this.work||!this.work.id)}},watch:{visible:function(t){t?this.bootstrap():this.reset()}},methods:{bootstrap:function(){if(this.isEdit){var t,e=this.work;this.form.title=e.title||"",this.form.slug=e.slug||"",this.form.description=e.description||"",this.form.tagsText=(e.tags||[]).join(", "),this.form.is_published=!!e.is_published,this.form.sort_order=null!==(t=e.sort_order)&&void 0!==t?t:100,this.mainPreview=e.image_url||(Array.isArray(e.images)&&e.images.length?e.images[0].url:null),this.existingGallery=Array.isArray(e.images)?e.images.map(function(g){return{id:g.id,url:g.url}}):[]}else this.reset()},reset:function(){this.form={title:"",slug:"",description:"",tagsText:"",is_published:!0,sort_order:100},this.mainFile=null,this.mainPreview=null,this.newGallery=[],this.galleryPreviews=[],this.existingGallery=[],this.deletedIds=[],this.$refs.mainInput&&(this.$refs.mainInput.value=""),this.$refs.galleryInput&&(this.$refs.galleryInput.value="")},autoFillSlug:function(){!this.form.slug&&this.form.title&&(this.form.slug=this.slugify(this.form.title))},slugify:function(s){return s.toString().trim().toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9\-\u0531-\u0587]+/g,"").replace(/-+/g,"-").replace(/^-+|-+$/g,"")},onMainChange:function(t){var e,r=this,l=null===(e=t.target.files)||void 0===e?void 0:e[0];l&&(this.mainFile=l,this.previewFile(l,function(t){return r.mainPreview=t}))},onGalleryChange:function(t){for(var e=this,r=0,l=Array.from(t.target.files||[]);r<l.length;r++){var o=l[r];if(this.newGallery.length+this.existingGallery.length>=5)break;this.newGallery.push(o),this.previewFile(o,function(t){return e.galleryPreviews.push(t)})}t.target.value=""},removeNew:function(i){this.newGallery.splice(i,1),this.galleryPreviews.splice(i,1)},toggleDelete:function(t){var i=this.deletedIds.indexOf(t);-1===i?this.deletedIds.push(t):this.deletedIds.splice(i,1)},previewFile:function(t,e){var r=new FileReader;r.onload=function(t){return e(t.target.result)},r.readAsDataURL(t)},submit:function(){var t;if(!this.form.title.trim())return alert("Անունը պարտադիր է");if(!this.form.slug.trim())return alert("Slug-ը պարտադիր է");var e=this.form.tagsText.split(",").map(function(t){return t.trim()}).filter(Boolean),r=new FormData,l=function(t,e){null!=e&&("string"==typeof e&&""===e.trim()||r.append(t,e))};l("title",this.form.title),l("slug",this.form.slug),l("description",this.form.description),l("is_published",this.form.is_published?1:0),e.length&&e.forEach(function(t,i){return l("tags[".concat(i,"]"),t)}),void 0!==this.form.sort_order&&null!==this.form.sort_order&&l("sort_order",this.form.sort_order),this.mainFile&&r.append("image",this.mainFile),this.newGallery.forEach(function(t,i){return r.append("gallery[".concat(i,"]"),t)}),this.deletedIds.forEach(function(t,i){return r.append("deleted_gallery_images[".concat(i,"]"),t)}),this.$emit("submit",{asFormData:r,isEdit:this.isEdit,id:null===(t=this.work)||void 0===t?void 0:t.id})}}},o=r(11),component=Object(o.a)(l,function(){var t=this,e=t._self._c;return t.visible?e("div",{staticClass:"fixed inset-0 z-[1100] bg-black/50 flex items-center justify-center p-4",on:{click:function(e){return e.target!==e.currentTarget?null:t.$emit("close")}}},[e("div",{staticClass:"w-full max-w-3xl bg-white rounded-2xl shadow-xl flex flex-col max-h-[90vh]"},[e("div",{staticClass:"flex items-center justify-between p-4 border-b"},[e("h3",{staticClass:"text-lg font-semibold"},[t._v("\n        "+t._s(t.isEdit?"Խմբագրել աշխատանքը":"Ստեղծել նոր աշխատանք")+"\n      ")]),t._v(" "),e("button",{staticClass:"rounded-lg p-1 hover:bg-gray-100",on:{click:function(e){return t.$emit("close")}}},[t._v("\n        ✕\n      ")])]),t._v(" "),e("form",{staticClass:"p-5 overflow-y-auto",on:{submit:function(e){return e.preventDefault(),t.submit.apply(null,arguments)}}},[e("div",{staticClass:"grid grid-cols-1 sm:grid-cols-2 gap-4"},[e("div",[e("label",{staticClass:"block text-sm mb-1"},[t._v("Անուն")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.form.title,expression:"form.title",modifiers:{trim:!0}}],staticClass:"w-full rounded-lg border px-3 py-2",attrs:{type:"text"},domProps:{value:t.form.title},on:{blur:[t.autoFillSlug,function(e){return t.$forceUpdate()}],input:function(e){e.target.composing||t.$set(t.form,"title",e.target.value.trim())}}})]),t._v(" "),e("div",[e("label",{staticClass:"block text-sm mb-1"},[t._v("Slug")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.form.slug,expression:"form.slug",modifiers:{trim:!0}}],staticClass:"w-full rounded-lg border px-3 py-2",attrs:{type:"text",placeholder:"օր. laser-cucadrakan-ashxatak"},domProps:{value:t.form.slug},on:{input:function(e){e.target.composing||t.$set(t.form,"slug",e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}})])]),t._v(" "),e("div",{staticClass:"mt-4"},[e("label",{staticClass:"block text-sm mb-1"},[t._v("Նկարագրություն")]),t._v(" "),e("textarea",{directives:[{name:"model",rawName:"v-model.trim",value:t.form.description,expression:"form.description",modifiers:{trim:!0}}],staticClass:"w-full rounded-lg border px-3 py-2",attrs:{rows:"3"},domProps:{value:t.form.description},on:{input:function(e){e.target.composing||t.$set(t.form,"description",e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}})]),t._v(" "),e("div",{staticClass:"grid grid-cols-1 sm:grid-cols-3 gap-4 mt-4"},[e("div",{staticClass:"sm:col-span-2"},[e("label",{staticClass:"block text-sm mb-1"},[t._v("Tags (սեպարատ՝ comma)")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.form.tagsText,expression:"form.tagsText",modifiers:{trim:!0}}],staticClass:"w-full rounded-lg border px-3 py-2",attrs:{type:"text",placeholder:"laser, bend, welding"},domProps:{value:t.form.tagsText},on:{input:function(e){e.target.composing||t.$set(t.form,"tagsText",e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}})]),t._v(" "),e("div",{staticClass:"grid grid-cols-2 gap-4"},[e("label",{staticClass:"flex items-center gap-2 text-sm"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.form.is_published,expression:"form.is_published"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.form.is_published)?t._i(t.form.is_published,null)>-1:t.form.is_published},on:{change:function(e){var r=t.form.is_published,l=e.target,o=!!l.checked;if(Array.isArray(r)){var n=t._i(r,null);l.checked?n<0&&t.$set(t.form,"is_published",r.concat([null])):n>-1&&t.$set(t.form,"is_published",r.slice(0,n).concat(r.slice(n+1)))}else t.$set(t.form,"is_published",o)}}}),t._v("\n            Հրատարակված\n          ")]),t._v(" "),e("div",[e("label",{staticClass:"block text-sm mb-1"},[t._v("Sort order")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.form.sort_order,expression:"form.sort_order",modifiers:{number:!0}}],staticClass:"w-full rounded-lg border px-3 py-2",attrs:{type:"number",min:"0"},domProps:{value:t.form.sort_order},on:{input:function(e){e.target.composing||t.$set(t.form,"sort_order",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}})])])]),t._v(" "),e("div",{staticClass:"grid grid-cols-1 sm:grid-cols-2 gap-4 mt-6"},[e("div",[e("label",{staticClass:"block text-sm mb-1"},[t._v("Հիմնական պատկեր")]),t._v(" "),e("input",{ref:"mainInput",staticClass:"block w-full",attrs:{type:"file",accept:"image/*"},on:{change:t.onMainChange}}),t._v(" "),t.mainPreview?e("div",{staticClass:"mt-3"},[e("img",{staticClass:"w-28 h-28 object-cover rounded-lg border",attrs:{src:t.mainPreview}})]):t._e()]),t._v(" "),e("div",[e("label",{staticClass:"block text-sm mb-2"},[t._v("Գալերեա (մինչև 5)")]),t._v(" "),e("div",{staticClass:"flex flex-wrap gap-3"},[t._l(t.existingGallery,function(img){return e("div",{key:"ex-"+img.id,staticClass:"relative"},[e("img",{staticClass:"w-20 h-20 object-cover rounded-lg border",attrs:{src:img.url}}),t._v(" "),e("button",{staticClass:"absolute -top-2 -right-2 w-6 h-6 rounded-full bg-red-600 text-white text-sm",attrs:{type:"button",title:"Remove"},on:{click:function(e){return t.toggleDelete(img.id)}}},[t._v("\n                ×\n              ")]),t._v(" "),t.deletedIds.includes(img.id)?e("span",{staticClass:"absolute inset-0 bg-red-500/30 rounded-lg border border-red-500",attrs:{title:"Will be deleted"}}):t._e()])}),t._v(" "),t._l(t.galleryPreviews,function(p,i){return e("div",{key:"new-"+i,staticClass:"relative"},[e("img",{staticClass:"w-20 h-20 object-cover rounded-lg border",attrs:{src:p}}),t._v(" "),e("button",{staticClass:"absolute -top-2 -right-2 w-6 h-6 rounded-full bg-red-600 text-white text-sm",attrs:{type:"button",title:"Remove"},on:{click:function(e){return t.removeNew(i)}}},[t._v("\n                ×\n              ")])])}),t._v(" "),e("label",{staticClass:"w-20 h-20 flex items-center justify-center border-2 border-dashed rounded-lg cursor-pointer hover:border-blue-500"},[e("span",{staticClass:"text-2xl text-gray-400"},[t._v("+")]),t._v(" "),e("input",{ref:"galleryInput",staticClass:"hidden",attrs:{type:"file",accept:"image/*",multiple:""},on:{change:t.onGalleryChange}})])],2)])])]),t._v(" "),e("div",{staticClass:"flex justify-end gap-3 p-4 border-t"},[e("button",{staticClass:"px-4 py-2 rounded-lg border",attrs:{type:"button"},on:{click:function(e){return t.$emit("close")}}},[t._v("\n        Փակել\n      ")]),t._v(" "),e("button",{staticClass:"px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 disabled:bg-blue-400",attrs:{type:"button",disabled:t.submitting},on:{click:t.submit}},[t._v("\n        "+t._s(t.submitting?"Պահպանում…":t.isEdit?"Պահպանել":"Ստեղծել")+"\n      ")])])])]):t._e()},[],!1,null,null,null);e.default=component.exports}}]);