(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{463:function(t,e,r){"use strict";var n=r(3),l=r(282).trim;n({target:"String",proto:!0,forced:r(464)("trim")},{trim:function(){return l(this)}})},464:function(t,e,r){"use strict";var n=r(112).PROPER,l=r(5),o=r(283);t.exports=function(t){return l(function(){return!!o[t]()||"​᠎"!=="​᠎"[t]()||n&&o[t].name!==t})}},532:function(t,e,r){"use strict";r.r(e);r(19),r(42),r(53),r(18),r(60),r(463),r(48),r(46),r(43),r(44),r(113),r(190),r(6),r(23),r(32),r(27),r(26),r(28);function n(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,a){if(t){if("string"==typeof t)return l(t,a);var e={}.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?l(t,a):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var d,a=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){u=!0,d=t},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw d}}}}function l(t,a){(null==a||a>t.length)&&(a=t.length);for(var e=0,r=Array(a);e<a;e++)r[e]=t[e];return r}var o={name:"ProductFormModal",props:{visible:{type:Boolean,default:!1},product:{type:Object,default:null},submitting:{type:Boolean,default:!1}},data:function(){return{MAX_MB:4,GALLERY_MAX:5,form:{name:"",description:"",price:null},errors:{},isDraggingMain:!1,mainFile:null,mainPreview:null,isDraggingGallery:!1,newGallery:[],galleryPreviews:[],existingGallery:[],deletedIds:[]}},computed:{isEdit:function(){return!(!this.product||!this.product.id)},totalGalleryCount:function(){return this.existingGallery.length-this.deletedIds.length+this.newGallery.length},canSubmit:function(){var t=!(!this.mainFile&&!this.mainPreview);return this.form.name.trim()&&this.form.description.trim()&&null!==this.form.price&&Number(this.form.price)>=0&&t&&!this.submitting}},watch:{visible:function(t){document.documentElement.classList.toggle("overflow-hidden",t),t?this.bootstrap():this.resetLocal()}},beforeDestroy:function(){document.documentElement.classList.remove("overflow-hidden")},methods:{bootstrap:function(){var t;(this.errors={},this.isEdit)?(this.form.name=this.product.name||"",this.form.description=this.product.description||"",this.form.price=null!==(t=this.product.price)&&void 0!==t?t:0,this.mainPreview=this.product.image_url||null,this.existingGallery=Array.isArray(this.product.images)?this.product.images.map(function(g){return{id:g.id,url:g.url}}):[]):this.resetLocal()},resetLocal:function(){this.form={name:"",description:"",price:null},this.errors={},this.mainFile=null,this.mainPreview=null,this.isDraggingMain=!1,this.newGallery=[],this.galleryPreviews=[],this.isDraggingGallery=!1,this.existingGallery=[],this.deletedIds=[],this.$refs.mainInput&&(this.$refs.mainInput.value=""),this.$refs.galleryInput&&(this.$refs.galleryInput.value="")},validateImage:function(t){if(!t)return"Պատկեր չի ընտրվել";if(!/image\/(jpeg|jpg|png|webp|gif)/i.test(t.type))return"Ֆայլի տիպը պետք է լինի jpeg/png/webp/gif";var e=1024*this.MAX_MB*1024;return t.size>e?"Պատկերը չպետք է գերազանցի ".concat(this.MAX_MB,"MB"):null},previewFile:function(t,e){var r=new FileReader;r.onload=function(t){return e(t.target.result)},r.readAsDataURL(t)},onMainChange:function(t){var e,r=null===(e=t.target.files)||void 0===e?void 0:e[0];this.addMainImage(r),t.target.value=""},onDropMain:function(t){var e;this.isDraggingMain=!1;var r=null===(e=t.dataTransfer)||void 0===e||null===(e=e.files)||void 0===e?void 0:e[0];this.addMainImage(r)},addMainImage:function(t){var e=this,r=this.validateImage(t);r?this.errors.image=r:(this.mainFile=t,this.previewFile(t,function(t){return e.mainPreview=t}),this.errors.image=null)},clearMainImage:function(){var t;this.mainFile=null,this.isEdit&&null!==(t=this.product)&&void 0!==t&&t.image_url||(this.mainPreview=null)},onGalleryChange:function(t){var e=Array.from(t.target.files||[]);this.addGalleryFiles(e),t.target.value=""},onDropGallery:function(t){var e;this.isDraggingGallery=!1;var r=Array.from((null===(e=t.dataTransfer)||void 0===e?void 0:e.files)||[]);this.addGalleryFiles(r)},addGalleryFiles:function(t){var e=this,r=this.GALLERY_MAX-this.totalGalleryCount;if(r<=0)this.errors.gallery="Առավելագույնը ".concat(this.GALLERY_MAX," պատկեր");else{var l,o=n(t.slice(0,r));try{for(o.s();!(l=o.n()).done;){var d=l.value,c=this.validateImage(d);if(c)return void(this.errors.gallery=c);this.newGallery.push(d),this.previewFile(d,function(t){return e.galleryPreviews.push(t)})}}catch(c){o.e(c)}finally{o.f()}this.errors.gallery=null}},removeNew:function(i){this.newGallery.splice(i,1),this.galleryPreviews.splice(i,1),this.totalGalleryCount<this.GALLERY_MAX&&(this.errors.gallery=null)},toggleDelete:function(t){var i=this.deletedIds.indexOf(t);-1===i?this.deletedIds.push(t):this.deletedIds.splice(i,1)},setMainFromExisting:function(i){var t=this.existingGallery[i];t&&t.url&&(this.mainFile=null,this.mainPreview=t.url)},setMainFromNew:function(i){var t=this.newGallery[i],p=this.galleryPreviews[i];t&&(this.mainFile=t,this.mainPreview=p,this.removeNew(i),this.errors.image=null)},validateForm:function(){this.errors={};var t=!0;return this.form.name.trim()||(this.errors.name="Անունը պարտադիր է",t=!1),this.form.description.trim()||(this.errors.description="Նկարագրությունը պարտադիր է",t=!1),(null==this.form.price||Number(this.form.price)<0)&&(this.errors.price="Արժեքը պետք է լինի 0 կամ ավելի",t=!1),!(!this.mainFile&&!this.mainPreview)||(this.errors.image="Հիմնական պատկերը պարտադիր է",t=!1),this.totalGalleryCount>this.GALLERY_MAX&&(this.errors.gallery="Առավելագույնը ".concat(this.GALLERY_MAX," պատկեր"),t=!1),t},submit:function(){var t;if(this.validateForm()){var e=new FormData;e.append("name",this.form.name),e.append("description",this.form.description),e.append("price",String(this.form.price)),this.mainFile&&e.append("image",this.mainFile),this.newGallery.forEach(function(t,i){return e.append("gallery[".concat(i,"]"),t)}),this.deletedIds.forEach(function(t,i){return e.append("deleted_gallery_images[".concat(i,"]"),t)}),this.$emit("submit",{asFormData:e,isEdit:this.isEdit,id:null===(t=this.product)||void 0===t?void 0:t.id})}}}},d=r(11),component=Object(d.a)(o,function(){var t=this,e=t._self._c;return t.visible?e("div",{staticClass:"fixed inset-0 z-[1100] bg-black/50 flex items-center justify-center p-4 sm:p-6",on:{click:function(e){return e.target!==e.currentTarget?null:t.$emit("close")}}},[e("div",{staticClass:"w-full max-w-2xl bg-white dark:bg-gray-900 rounded-none sm:rounded-2xl shadow-xl h-full sm:h-auto max-h-full sm:max-h-[90vh] flex flex-col",attrs:{role:"dialog","aria-modal":"true"}},[e("div",{staticClass:"sticky top-0 z-10 flex items-center justify-between px-5 py-4 border-b bg-white/90 dark:bg-gray-900/90 backdrop-blur"},[e("h3",{staticClass:"text-lg font-semibold text-gray-900 dark:text-white"},[t._v("\n        "+t._s(t.isEdit?"Խմբագրել ապրանքը":"Ստեղծել նոր ապրանք")+"\n      ")]),t._v(" "),e("button",{staticClass:"rounded-lg p-1 hover:bg-gray-100 dark:hover:bg-gray-800",attrs:{"aria-label":"Փակել մոդալը"},on:{click:function(e){return t.$emit("close")}}},[t._v("\n        ✕\n      ")])]),t._v(" "),e("form",{staticClass:"flex-1 overflow-y-auto px-5 sm:px-6 py-5 space-y-5",attrs:{id:"productForm"},on:{submit:function(e){return e.preventDefault(),t.submit.apply(null,arguments)}}},[e("div",[e("label",{staticClass:"block text-sm font-medium text-gray-700 dark:text-gray-300"},[t._v("Անուն *")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.form.name,expression:"form.name",modifiers:{trim:!0}}],staticClass:"mt-1 w-full rounded-lg border-gray-300 px-3 py-2 focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 dark:text-white",class:{"border-red-500":t.errors.name},attrs:{type:"text",disabled:t.submitting,placeholder:"Օր․ «Մետաղական դետալ №5»"},domProps:{value:t.form.name},on:{input:function(e){e.target.composing||t.$set(t.form,"name",e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}}),t._v(" "),t.errors.name?e("p",{staticClass:"mt-1 text-sm text-red-600"},[t._v("\n          "+t._s(t.errors.name)+"\n        ")]):t._e()]),t._v(" "),e("div",[e("label",{staticClass:"block text-sm font-medium text-gray-700 dark:text-gray-300"},[t._v("Նկարագրություն *")]),t._v(" "),e("textarea",{directives:[{name:"model",rawName:"v-model.trim",value:t.form.description,expression:"form.description",modifiers:{trim:!0}}],staticClass:"mt-1 w-full rounded-lg border-gray-300 px-3 py-2 focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 dark:text-white",class:{"border-red-500":t.errors.description},attrs:{rows:"3",disabled:t.submitting,placeholder:"Կարճ նկարագրություն…"},domProps:{value:t.form.description},on:{input:function(e){e.target.composing||t.$set(t.form,"description",e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}}),t._v(" "),t.errors.description?e("p",{staticClass:"mt-1 text-sm text-red-600"},[t._v("\n          "+t._s(t.errors.description)+"\n        ")]):t._e()]),t._v(" "),e("div",[e("label",{staticClass:"block text-sm font-medium text-gray-700 dark:text-gray-300"},[t._v("Արժեք (֏) *")]),t._v(" "),e("div",{staticClass:"mt-1 relative"},[e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.form.price,expression:"form.price",modifiers:{number:!0}}],staticClass:"w-full rounded-lg border-gray-300 pr-12 px-3 py-2 focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 dark:text-white",class:{"border-red-500":t.errors.price},attrs:{type:"number",min:"0",step:"1",disabled:t.submitting,placeholder:"Օր․ 120000"},domProps:{value:t.form.price},on:{input:function(e){e.target.composing||t.$set(t.form,"price",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),t._v(" "),e("span",{staticClass:"absolute inset-y-0 right-3 flex items-center text-gray-400 select-none"},[t._v("֏")])]),t._v(" "),t.errors.price?e("p",{staticClass:"mt-1 text-sm text-red-600"},[t._v("\n          "+t._s(t.errors.price)+"\n        ")]):t._e()]),t._v(" "),e("div",[e("label",{staticClass:"block text-sm font-medium text-gray-700 dark:text-gray-300"},[t._v("Հիմնական պատկեր *")]),t._v(" "),e("div",{staticClass:"mt-2 flex items-center justify-center rounded-xl border-2 border-dashed p-6 text-center transition-colors",class:[t.isDraggingMain?"border-blue-500 bg-blue-50/50 dark:bg-blue-900/10":"border-gray-300 dark:border-gray-700",t.errors.image?"border-red-500":""],on:{dragover:function(e){e.preventDefault(),t.isDraggingMain=!0},dragleave:function(e){e.preventDefault(),t.isDraggingMain=!1},drop:function(e){return e.preventDefault(),t.onDropMain.apply(null,arguments)}}},[t.mainPreview?e("div",{staticClass:"w-full sm:w-auto"},[e("div",{staticClass:"relative inline-block"},[e("img",{staticClass:"w-40 h-40 object-cover rounded-xl border",attrs:{src:t.mainPreview,alt:"Main preview"}}),t._v(" "),e("div",{staticClass:"absolute -top-2 -right-2 flex gap-2"},[e("button",{staticClass:"px-2 py-1 rounded-md bg-white/90 border text-xs hover:bg-white shadow",attrs:{type:"button"},on:{click:function(e){return t.$refs.mainInput.click()}}},[t._v("\n                  Փոխել\n                ")]),t._v(" "),e("button",{staticClass:"px-2 py-1 rounded-md bg-red-600 text-white text-xs hover:bg-red-700 shadow",attrs:{type:"button"},on:{click:t.clearMainImage}},[t._v("\n                  Հեռացնել\n                ")])])])]):e("div",{staticClass:"space-y-2"},[e("p",{staticClass:"text-sm text-gray-600 dark:text-gray-400"},[t._v("\n              Քաշեք & թողեք պատկերը այստեղ կամ\n              "),e("button",{staticClass:"text-blue-600 font-medium hover:underline",attrs:{type:"button"},on:{click:function(e){return t.$refs.mainInput.click()}}},[t._v("\n                ընտրեք ֆայլ\n              ")])]),t._v(" "),e("p",{staticClass:"text-xs text-gray-400"},[t._v("\n              Մինչև "+t._s(t.MAX_MB)+"MB, τύպերը՝ jpeg/png/webp/gif\n            ")]),t._v(" "),e("input",{ref:"mainInput",staticClass:"hidden",attrs:{type:"file",accept:"image/*",disabled:t.submitting},on:{change:t.onMainChange}})])]),t._v(" "),t.errors.image?e("p",{staticClass:"mt-2 text-sm text-red-600"},[t._v("\n          "+t._s(t.errors.image)+"\n        ")]):t._e()]),t._v(" "),e("div",[e("div",{staticClass:"flex items-center justify-between"},[e("label",{staticClass:"block text-sm font-medium text-gray-700 dark:text-gray-300"},[t._v("Գալերեայի նկարներ")]),t._v(" "),e("div",{staticClass:"text-xs text-gray-500"},[t._v("\n            "+t._s(t.totalGalleryCount)+"/"+t._s(t.GALLERY_MAX)+"\n          ")])]),t._v(" "),e("div",{staticClass:"mt-2 rounded-xl border-2 border-dashed p-4 transition-colors",class:t.isDraggingGallery?"border-blue-500 bg-blue-50/50 dark:bg-blue-900/10":"border-gray-300 dark:border-gray-700",on:{dragover:function(e){e.preventDefault(),t.isDraggingGallery=!0},dragleave:function(e){e.preventDefault(),t.isDraggingGallery=!1},drop:function(e){return e.preventDefault(),t.onDropGallery.apply(null,arguments)}}},[e("div",{staticClass:"flex flex-wrap gap-3"},[t._l(t.existingGallery,function(img,i){return e("div",{key:"ex-"+img.id,staticClass:"relative group"},[e("img",{staticClass:"w-24 h-24 object-cover rounded-lg border",attrs:{src:img.url}}),t._v(" "),e("div",{staticClass:"absolute -top-2 -right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition"},[e("button",{staticClass:"px-1.5 py-0.5 rounded bg-white text-xs border hover:bg-gray-50 shadow",attrs:{type:"button",title:"Դնել որպես հիմնական"},on:{click:function(e){return t.setMainFromExisting(i)}}},[t._v("\n                  ★\n                ")]),t._v(" "),e("button",{staticClass:"px-1.5 py-0.5 rounded text-white text-xs shadow",class:t.deletedIds.includes(img.id)?"bg-gray-500 hover:bg-gray-600":"bg-red-600 hover:bg-red-700",attrs:{type:"button",title:t.deletedIds.includes(img.id)?"Չեղարկել ջնջումը":"Ջնջել"},on:{click:function(e){return t.toggleDelete(img.id)}}},[t._v("\n                  ×\n                ")])]),t._v(" "),t.deletedIds.includes(img.id)?e("span",{staticClass:"absolute inset-0 bg-red-500/25 rounded-lg border border-red-500 pointer-events-none",attrs:{title:"Will be deleted"}}):t._e()])}),t._v(" "),t._l(t.galleryPreviews,function(p,i){return e("div",{key:"new-"+i,staticClass:"relative group"},[e("img",{staticClass:"w-24 h-24 object-cover rounded-lg border",attrs:{src:p}}),t._v(" "),e("div",{staticClass:"absolute -top-2 -right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition"},[e("button",{staticClass:"px-1.5 py-0.5 rounded bg-white text-xs border hover:bg-gray-50 shadow",attrs:{type:"button",title:"Դնել որպես հիմնական"},on:{click:function(e){return t.setMainFromNew(i)}}},[t._v("\n                  ★\n                ")]),t._v(" "),e("button",{staticClass:"px-1.5 py-0.5 rounded bg-red-600 text-white text-xs hover:bg-red-700 shadow",attrs:{type:"button",title:"Հեռացնել"},on:{click:function(e){return t.removeNew(i)}}},[t._v("\n                  ×\n                ")])])])}),t._v(" "),e("label",{staticClass:"w-24 h-24 flex items-center justify-center border-2 border-dashed rounded-lg cursor-pointer hover:border-blue-500 text-gray-400",class:{"pointer-events-none opacity-40":t.totalGalleryCount>=t.GALLERY_MAX}},[e("span",{staticClass:"text-3xl leading-none"},[t._v("+")]),t._v(" "),e("input",{ref:"galleryInput",staticClass:"hidden",attrs:{type:"file",accept:"image/*",multiple:"",disabled:t.submitting||t.totalGalleryCount>=t.GALLERY_MAX},on:{change:t.onGalleryChange}})])],2),t._v(" "),e("p",{staticClass:"mt-2 text-xs text-gray-400"},[t._v("\n            Առավելագույնը "+t._s(t.GALLERY_MAX)+" պատկեր (յուրաքանչյուրն մինչև\n            "+t._s(t.MAX_MB)+"MB)\n          ")])]),t._v(" "),t.errors.gallery?e("p",{staticClass:"mt-2 text-sm text-red-600"},[t._v("\n          "+t._s(t.errors.gallery)+"\n        ")]):t._e()])]),t._v(" "),e("div",{staticClass:"sticky bottom-0 z-10 px-5 sm:px-6 py-4 border-t bg-white/90 dark:bg-gray-900/90 backdrop-blur flex flex-col sm:flex-row gap-3 justify-end"},[e("button",{staticClass:"px-4 py-2 rounded-lg border hover:bg-gray-50 dark:border-gray-700 dark:hover:bg-gray-800",attrs:{type:"button",disabled:t.submitting},on:{click:t.resetLocal}},[t._v("\n        Սկսել զրոյից\n      ")]),t._v(" "),e("button",{staticClass:"px-4 py-2 rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700",attrs:{type:"button",disabled:t.submitting},on:{click:function(e){return t.$emit("close")}}},[t._v("\n        Փակել\n      ")]),t._v(" "),e("button",{staticClass:"px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 disabled:bg-blue-400 inline-flex items-center gap-2",attrs:{type:"submit",form:"productForm",disabled:t.submitting||!t.canSubmit}},[t.submitting?e("svg",{staticClass:"w-4 h-4 animate-spin",attrs:{viewBox:"0 0 24 24",fill:"none"}},[e("circle",{staticClass:"opacity-25",attrs:{cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}}),t._v(" "),e("path",{staticClass:"opacity-75",attrs:{fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"}})]):t._e(),t._v(" "),e("span",[t._v(t._s(t.submitting?"Պահպանում…":t.isEdit?"Պահպանել":"Ստեղծել"))])])])])]):t._e()},[],!1,null,null,null);e.default=component.exports}}]);