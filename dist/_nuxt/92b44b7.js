(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{420:function(e,r,t){var content=t(423);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,t(23).default)("dbf01c20",content,!0,{sourceMap:!1})},422:function(e,r,t){"use strict";t(420)},423:function(e,r,t){var n=t(22)(function(i){return i[1]});n.push([e.i,"canvas{background-color:#fff;border:1px solid #ccc;display:block;margin:auto}.line-color{stroke:#000}.error-message{color:red;margin-top:10px;text-align:center}",""]),n.locals={},e.exports=n},431:function(e,r,t){"use strict";t.r(r);var n=t(0),o=(t(11),t(54),t(39),t(10),t(38),t(410)),c=t(435),l=t(442),f={props:{dxfUrl:{type:String,required:!0}},data:function(){return{scene:null,camera:null,renderer:null,dxfGroup:null,error:null}},watch:{dxfUrl:function(){this.loadDxfFile()}},mounted:function(){this.initThreeJS(),this.loadDxfFile()},beforeDestroy:function(){this.cleanupThreeJS()},methods:{initThreeJS:function(){this.scene=new o.ad,this.camera=new o.cc(75,this.$refs.canvas.clientWidth/this.$refs.canvas.clientHeight,.1,1e3),this.renderer=new c.a({canvas:this.$refs.canvas,antialias:!0}),this.renderer.setClearColor(16777215,1),this.renderer.setSize(this.$refs.canvas.clientWidth,this.$refs.canvas.clientHeight)},cleanupThreeJS:function(){this.renderer&&this.renderer.dispose(),this.scene&&(this.scene.traverse(function(object){(object.isMesh||object.isLine)&&(object.geometry&&object.geometry.dispose(),object.material&&(Array.isArray(object.material)?object.material.forEach(function(e){return e.dispose()}):object.material.dispose()))}),this.scene.clear()),this.dxfGroup&&(this.dxfGroup.traverse(function(object){(object.isMesh||object.isLine)&&(object.geometry&&object.geometry.dispose(),object.material&&(Array.isArray(object.material)?object.material.forEach(function(e){return e.dispose()}):object.material.dispose()))}),this.dxfGroup.clear())},loadDxfFile:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark(function r(){var t,n,o,c,l,f;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=1,e.$axios.get("/api/factories/getFile/".concat(e.dxfUrl));case 1:if(200===(t=r.sent).status){r.next=2;break}throw new Error("HTTP սխալ: Կոդը ".concat(t.status));case 2:if((n=t.data)&&n.content){r.next=3;break}throw new Error("Ֆայլի տվյալները բացակայում են պատասխանում։");case 3:try{c=atob(n.content),l=JSON.parse(c),o=l.content?atob(l.content):c}catch(e){o=atob(n.content)}e.parseDxf(o),e.error=null,r.next=5;break;case 4:r.prev=4,f=r.catch(0),console.error("DXF ֆայլը բեռնելիս սխալ:",f),e.error=f.message;case 5:case"end":return r.stop()}},r,null,[[0,4]])}))()},parseDxf:function(e){var r=this;try{var t=(new l.a).parseSync(e);if(!t||!t.entities)throw new Error("DXF ֆայլը մշակելիս սխալ կամ տվյալներ չեն գտնվել։");this.dxfGroup&&(this.scene.remove(this.dxfGroup),this.dxfGroup=null),this.dxfGroup=new o.ab,t.entities.forEach(function(e){var t,n;if("LINE"===e.type){n=new o.jb({color:0}),t=(new o.n).setFromPoints([new o.wd(e.vertices[0].x,e.vertices[0].y,0),new o.wd(e.vertices[1].x,e.vertices[1].y,0)]);var line=new o.kb(t,n);r.dxfGroup.add(line)}else if("LWPOLYLINE"===e.type){n=new o.jb({color:255}),t=(new o.n).setFromPoints(e.vertices.map(function(e){return new o.wd(e.x,e.y,0)}));var polyline=new o.ib(t,n);r.dxfGroup.add(polyline)}}),this.scene.add(this.dxfGroup);var n=(new o.k).setFromObject(this.dxfGroup),c=n.getCenter(new o.wd),f=n.getSize(new o.wd);this.dxfGroup.position.set(-c.x,-c.y,0);var h=Math.max(f.x,f.y),d=this.camera.fov*(Math.PI/180),w=Math.abs(h/(2*Math.tan(d/2)));this.camera.position.set(0,0,w+10),this.camera.lookAt(new o.wd(0,0,0)),this.renderer.render(this.scene,this.camera)}catch(e){this.error=e.message}}}},h=(t(422),t(7)),component=Object(h.a)(f,function(){var e=this,r=e._self._c;return r("div",[r("canvas",{ref:"canvas",staticClass:"line-color w-full h-full flex items-center justify-center"}),e._v(" "),e.error?r("div",{staticClass:"error-message"},[e._v("\n    DXF ֆայլը բեռնելիս սխալ՝ "+e._s(e.error)+"\n  ")]):e._e()])},[],!1,null,null,null);r.default=component.exports}}]);