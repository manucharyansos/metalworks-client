(window.webpackJsonp=window.webpackJsonp||[]).push([[40,8,17],{387:function(e,t,r){var content=r(394);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(35).default)("dbf01c20",content,!0,{sourceMap:!1})},388:function(e,t,r){"use strict";r.r(t);r(242);var n={name:"InputWithLabels",props:{id:{type:String,default:""},label:{type:String,default:""},type:{type:String,default:"text"},value:{type:[String,Number],default:""},disabled:{type:Boolean,default:!1},classes:{type:String,default:""},plaseholder:{type:String,default:""}}},o=r(15),component=Object(o.a)(n,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"relative"},[t("span",{staticClass:"absolute start-0 bottom-3 text-gray-500 dark:text-gray-400"},[e._t("label_svg")],2),e._v(" "),t("input",{staticClass:"block py-2.5 ps-8 pe-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer",class:e.classes,attrs:{id:e.id,type:e.type,disabled:e.disabled,plaseholder:e.plaseholder},domProps:{value:e.value},on:{input:function(t){return e.$emit("input",t.target.value)}}}),e._v(" "),t("label",{staticClass:"absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform scale-75 top-3 left-6 origin-[0] peer-focus:text-blue-600 peer-focus:dark:text-blue-500 peer-focus:scale-75 peer-focus:-translate-y-6",attrs:{for:e.id}},[e._v("\n    "+e._s(e.label)+"\n  ")]),e._v(" "),t("span",{staticClass:"absolute end-2 bottom-4 text-gray-500 dark:text-gray-400"},[e._t("label_back")],2)])}),[],!1,null,null,null);t.default=component.exports},393:function(e,t,r){"use strict";r(387)},394:function(e,t,r){var n=r(34)((function(i){return i[1]}));n.push([e.i,"canvas{background-color:#fff;border:1px solid #ccc;display:block;margin:auto}.line-color{stroke:#000}.error-message{color:red;margin-top:10px;text-align:center}",""]),n.locals={},e.exports=n},397:function(e,t,r){"use strict";r.r(t);var n=r(0),o=(r(11),r(52),r(50),r(12),r(44),r(385)),c=r(403),l=r(404),d={props:{dxfUrl:{type:String,required:!0}},data:function(){return{scene:null,camera:null,renderer:null,dxfGroup:null,error:null}},watch:{dxfUrl:function(){this.loadDxfFile()}},mounted:function(){this.initThreeJS(),this.loadDxfFile()},beforeDestroy:function(){this.cleanupThreeJS()},methods:{initThreeJS:function(){this.scene=new o.ad,this.camera=new o.cc(75,this.$refs.canvas.clientWidth/this.$refs.canvas.clientHeight,.1,1e3),this.renderer=new c.a({canvas:this.$refs.canvas,antialias:!0}),this.renderer.setClearColor(16777215,1),this.renderer.setSize(this.$refs.canvas.clientWidth,this.$refs.canvas.clientHeight)},cleanupThreeJS:function(){this.renderer&&this.renderer.dispose(),this.scene&&(this.scene.traverse((function(object){(object.isMesh||object.isLine)&&(object.geometry&&object.geometry.dispose(),object.material&&(Array.isArray(object.material)?object.material.forEach((function(e){return e.dispose()})):object.material.dispose()))})),this.scene.clear()),this.dxfGroup&&(this.dxfGroup.traverse((function(object){(object.isMesh||object.isLine)&&(object.geometry&&object.geometry.dispose(),object.material&&(Array.isArray(object.material)?object.material.forEach((function(e){return e.dispose()})):object.material.dispose()))})),this.dxfGroup.clear())},loadDxfFile:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r,n,o,c,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$axios.get("/api/factories/getFile/".concat(e.dxfUrl));case 3:if(200===(r=t.sent).status){t.next=6;break}throw new Error("HTTP սխալ: Կոդը ".concat(r.status));case 6:if((n=r.data)&&n.content){t.next=9;break}throw new Error("Ֆայլի տվյալները բացակայում են պատասխանում։");case 9:try{c=atob(n.content),l=JSON.parse(c),o=l.content?atob(l.content):c}catch(e){o=atob(n.content)}e.parseDxf(o),e.error=null,t.next=18;break;case 14:t.prev=14,t.t0=t.catch(0),console.error("DXF ֆայլը բեռնելիս սխալ:",t.t0),e.error=t.t0.message;case 18:case"end":return t.stop()}}),t,null,[[0,14]])})))()},parseDxf:function(e){var t=this;try{var r=(new l.a).parseSync(e);if(!r||!r.entities)throw new Error("DXF ֆայլը մշակելիս սխալ կամ տվյալներ չեն գտնվել։");this.dxfGroup&&(this.scene.remove(this.dxfGroup),this.dxfGroup=null),this.dxfGroup=new o.ab,r.entities.forEach((function(e){var r,n;if("LINE"===e.type){n=new o.jb({color:0}),r=(new o.n).setFromPoints([new o.wd(e.vertices[0].x,e.vertices[0].y,0),new o.wd(e.vertices[1].x,e.vertices[1].y,0)]);var line=new o.kb(r,n);t.dxfGroup.add(line)}else if("LWPOLYLINE"===e.type){n=new o.jb({color:255}),r=(new o.n).setFromPoints(e.vertices.map((function(e){return new o.wd(e.x,e.y,0)})));var polyline=new o.ib(r,n);t.dxfGroup.add(polyline)}})),this.scene.add(this.dxfGroup);var n=(new o.k).setFromObject(this.dxfGroup),c=n.getCenter(new o.wd),d=n.getSize(new o.wd);this.dxfGroup.position.set(-c.x,-c.y,0);var f=Math.max(d.x,d.y),h=this.camera.fov*(Math.PI/180),y=Math.abs(f/(2*Math.tan(h/2)));this.camera.position.set(0,0,y+10),this.camera.lookAt(new o.wd(0,0,0)),this.renderer.render(this.scene,this.camera)}catch(e){this.error=e.message}}}},f=(r(393),r(15)),component=Object(f.a)(d,(function(){var e=this,t=e._self._c;return t("div",[t("canvas",{ref:"canvas",staticClass:"line-color w-full h-full flex items-center justify-center"}),e._v(" "),e.error?t("div",{staticClass:"error-message"},[e._v("\n    DXF ֆայլը բեռնելիս սխալ՝ "+e._s(e.error)+"\n  ")]):e._e()])}),[],!1,null,null,null);t.default=component.exports},458:function(e,t,r){var content=r(510);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(35).default)("3b2500ad",content,!0,{sourceMap:!1})},509:function(e,t,r){"use strict";r(458)},510:function(e,t,r){var n=r(34)((function(i){return i[1]}));n.push([e.i,".container[data-v-291eef8c]{padding:1rem}.show_file_section[data-v-291eef8c],.show_files_name[data-v-291eef8c]{border:1px solid #ccc;padding:1rem}.cursor-pointer[data-v-291eef8c]{cursor:pointer}ol[data-v-291eef8c]{list-style-type:decimal}",""]),n.locals={},e.exports=n},555:function(e,t,r){"use strict";r.r(t);r(20),r(57),r(33),r(56),r(53),r(77),r(78),r(26),r(31);var n=r(29),o=r(0),c=r(36),l=(r(11),r(39),r(51),r(45),r(80),r(50),r(12),r(97),r(25),r(44),r(30),r(246),r(247),r(160),r(79)),d=r(397);function f(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,a){if(e){if("string"==typeof e)return h(e,a);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?h(e,a):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,a=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){u=!0,c=e},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw c}}}}function h(e,a){(null==a||a>e.length)&&(a=e.length);for(var t=0,r=Array(a);t<a;t++)r[t]=e[t];return r}function y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function v(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?y(Object(r),!0).forEach((function(t){Object(c.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var x={components:{InputWithLabels:r(388).default,DxfViewer:d.default},layout:"EngineerLayout",middleware:["engineer","roleRedirect"],data:function(){return{expandedFileIndex:null,quantityMap:{},factories:{ids:[],files:{}},isDoneDetails:!0,selectedClient:null,order:{name:null,quantity:null,description:null},formSubmitted:!1,isSelectedLaser:!1,isSelectedBend:!1,fileNames:[],dxfUrl:"",files:[],selectedFactoryId:null,selectedFileIndex:null,orderId:null}},computed:v(v(v(v({},Object(l.c)("factory",["getFactory"])),Object(l.c)("users",["getUsers"])),Object(l.c)("engineer",["getOrder"])),{},{users:function(){return this.getUsers}}),mounted:function(){var e=this;this.fetchUsers(),this.fetchFactory(),this.formSubmitted=!0,this.isDoneDetails=!1,this.selectedFactoryId=1,this.factories.ids.includes(1)||this.factories.ids.push(1),this.factories.files[1]||(this.factories.files[1]=[]),this.selectedFileIndex=null,this.dxfUrl="",this.fileNames=[],this.orderId=this.$route.params.id,this.fetchOrderDataById(this.orderId).then((function(){e.initializeFiles()}))},methods:v(v(v(v({},Object(l.b)("factory",["fetchFactory"])),Object(l.b)("users",["fetchUsers"])),Object(l.b)("engineer",["createNewOrder","fetchOrderDataById","saveOrderFilesByFactory"])),{},{toggleAddQuantity:function(e){this.expandedFileIndex=this.expandedFileIndex===e?null:e,this.quantityMap[e]||(this.quantityMap[e]="")},initializeFiles:function(){var e=this.getOrder;if(e&&e.factory_orders){var t,r=f(e.factory_orders);try{for(r.s();!(t=r.n()).done;){var n=t.value,o=n.factory_id;this.factories.files[o]||(this.factories.files[o]=[]);var c,l=f(n.files);try{for(l.s();!(c=l.n()).done;){var d=c.value;try{var h=d.path;this.factories.files[o].push({name:d.original_name,path:h})}catch(e){this.$notify({text:e,duration:3e3,speed:1e3,position:"top",type:"success"})}}}catch(e){l.e(e)}finally{l.f()}}}catch(e){r.e(e)}finally{r.f()}}},selectFactory:function(e){this.selectedFactoryId=e.id,this.factories.ids.includes(e.id)||this.factories.ids.push(e.id),this.factories.files[e.id]||(this.factories.files[e.id]=[]),this.selectedFileIndex=null,this.dxfUrl="",this.fileNames=[]},selectFile:function(e){e&&e.path?this.dxfUrl=e.path:console.error("Invalid file object")},loadFile:function(e){var t=this;if(e instanceof File){var r=new FileReader;r.onload=function(){console.log("File content:",r.result),t.dxfUrl=URL.createObjectURL(e)},r.readAsText(e)}else console.error("Invalid file type")},saveFiles:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var r,o,c,l,d,h;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.orderId){t.next=3;break}return console.error("Պատվերի ID չի գտնվել։"),t.abrupt("return");case 3:(r=new FormData).append("order_id",e.orderId),Object.keys(e.factories.files).forEach((function(t){var n=e.factories.files[t]||[];n.length>0&&(r.append("factories[".concat(t,"][id]"),t),n.forEach((function(e,n){r.append("factories[".concat(t,"][files][").concat(n,"]"),e)})))})),o=f(r.entries());try{for(o.s();!(c=o.n()).done;)l=Object(n.a)(c.value,2),d=l[0],h=l[1],console.log(d,h)}catch(e){o.e(e)}finally{o.f()}return t.next=10,e.saveOrderFilesByFactory(r);case 10:return t.next=12,e.$router.push("/engineer");case 12:case"end":return t.stop()}}),t)})))()},doneToFiles:function(){},createOrder:function(){var e={user_id:this.selectedClient.id,name:this.order.name,quantity:this.order.quantity,description:this.order.description};this.createNewOrder(e)}})},m=(r(509),r(15)),component=Object(m.a)(x,(function(){var e,t=this,r=t._self._c;return r("div",{staticClass:"flex flex-col items-center justify-center gap-12 border border-neutral-400 shadow-xl rounded-xl py-4 m-6"},[r("div",{staticClass:"w-full flex flex-row items-center gap-12"},[r("div",{staticClass:"flex flex-row items-center mx-auto gap-12"},t._l(t.getFactory,(function(e,n){return r("div",{key:n},[r("button",{class:{"border border-neutral-600 rounded-lg px-3 py-1 italic font-sans":!0,"bg-gray-900 text-white":t.selectedFactoryId===e.id,"bg-gray-600 text-white":t.factories.files[e.id]&&t.factories.files[e.id].length>0},on:{click:function(r){return t.selectFactory(e)}}},[t._v("\n          "+t._s(e.name)+"\n        ")])])})),0),t._v(" "),r("nuxt-link",{staticClass:"ml-auto mr-6",attrs:{to:"/engineer"}},[r("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",x:"0px",y:"0px",width:"25",height:"25",fill:"red",viewBox:"0 0 30 30"}},[r("path",{attrs:{d:"M15,3C8.373,3,3,8.373,3,15c0,6.627,5.373,12,12,12s12-5.373,12-12C27,8.373,21.627,3,15,3z M16.414,15 c0,0,3.139,3.139,3.293,3.293c0.391,0.391,0.391,1.024,0,1.414c-0.391,0.391-1.024,0.391-1.414,0C18.139,19.554,15,16.414,15,16.414 s-3.139,3.139-3.293,3.293c-0.391,0.391-1.024,0.391-1.414,0c-0.391-0.391-0.391-1.024,0-1.414C10.446,18.139,13.586,15,13.586,15 s-3.139-3.139-3.293-3.293c-0.391-0.391-0.391-1.024,0-1.414c0.391-0.391,1.024-0.391,1.414,0C11.861,10.446,15,13.586,15,13.586 s3.139-3.139,3.293-3.293c0.391-0.391,1.024-0.391,1.414,0c0.391,0.391,0.391,1.024,0,1.414C19.554,11.861,16.414,15,16.414,15z"}})])])],1),t._v(" "),t.selectedFactoryId?r("div",{staticClass:"container flex flex-col"},[r("div",{staticClass:"grid grid-cols-2 gap-8"},[r("div",{staticClass:"show_file_section"},[t.dxfUrl?r("DxfViewer",{key:t.dxfUrl,attrs:{"dxf-url":t.dxfUrl}}):t._e()],1),t._v(" "),r("div",{staticClass:"show_files_name min-h-96 max-h-[32rem] overflow-y-auto"},[(null===(e=t.factories.files[t.selectedFactoryId])||void 0===e?void 0:e.length)>0?r("div",[r("ol",{staticClass:"list-decimal px-3"},t._l(t.factories.files[t.selectedFactoryId],(function(e,n){return r("li",{key:n,staticClass:"my-1"},[r("div",{staticClass:"cursor-pointer grid grid-cols-2 justify-between items-center",class:{"border border-neutral-600 rounded-lg px-3 py-1 italic font-sans":!0,"bg-gray-900 text-white":t.selectedFileIndex===n},on:{click:function(r){return t.selectFile(e)}}},[r("span",[t._v(t._s(e.name))]),t._v(" "),r("div",{staticClass:"text-center"},[t.expandedFileIndex!==n?r("p",{on:{click:function(e){return e.stopPropagation(),t.toggleAddQuantity(n)}}},[t._v("\n                    Ավելացնել Քանակ\n                  ")]):t._e(),t._v(" "),t.expandedFileIndex===n?r("input-with-labels",{staticClass:"shadow-md rounded-lg p-5",attrs:{id:"quantity",label:"Քանակ",type:"number"},model:{value:t.quantityMap[n],callback:function(e){t.$set(t.quantityMap,n,e)},expression:"quantityMap[index]"}}):t._e()],1)])])})),0)]):r("div",[r("p",[t._v("Ֆայլ չկա ընտրված գործարանի համար:")])])])]),t._v(" "),r("div",{staticClass:"flex flex-row items-center justify-end gap-12 text-right my-3"},[r("button",{staticClass:"border border-green-700 bg-green-700 text-white rounded-xl px-3 py-1",on:{click:t.saveFiles}},[t._v("\n        Պահպանել Ֆայլերը\n      ")]),t._v(" "),r("button",{staticClass:"border border-green-700 bg-green-700 text-white rounded-xl px-3 py-1"},[t._v("\n        Շարունակել\n      ")])])]):t._e()])}),[],!1,null,"291eef8c",null);t.default=component.exports}}]);